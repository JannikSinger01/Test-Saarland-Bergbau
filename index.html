<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas Saar: Gestern & Heute</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Inter', sans-serif; overflow: hidden; background-color: #f8fafc; }
        #map { height: 100%; width: 100%; z-index: 1; }
        .glass-panel { background: rgba(255, 255, 255, 0.92); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.6); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05); }
        ::-webkit-scrollbar { width: 4px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .tab-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .tab-btn.active { background-color: #0f172a; color: white; box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2); }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #0f172a; cursor: pointer; margin-top: -8px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); transition: transform 0.1s; }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #cbd5e1; border-radius: 2px; }
        .leaflet-popup-content-wrapper { border-radius: 12px; padding: 0; overflow: hidden; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
        .leaflet-popup-content { margin: 0 !important; width: 280px !important; }
        
        /* Details Content Animation - Increased Height for Long Text */
        .details-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; }
        .details-content.open { max-height: 1200px; transition: max-height 0.6s ease-in; }
        
        /* Overlay Animationen */
        .overlay-hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .overlay-visible { opacity: 1; visibility: visible; pointer-events: auto; }
        .transition-overlay { transition: opacity 0.5s ease, visibility 0.5s; }

        .custom-div-icon { background: transparent; border: none; }
        .reform-alert { animation: pulse-red 2s infinite; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); } }
        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .flag-box { width: 100px; height: 60px; background: rgba(255,255,255,0.1); border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: transform 0.3s; }
        .flag-box:hover { transform: scale(1.05); }
        .flag-img { width: 100%; height: 100%; object-fit: cover; }
        .location-img { width: 100%; height: 140px; object-fit: cover; background-color: #e2e8f0; }
        .copyright-text { font-size: 9px; color: #64748b; margin-top: 4px; text-align: right; font-style: italic; }
        
        /* Language Switcher Styles */
        .lang-btn { opacity: 0.5; transition: opacity 0.2s; }
        .lang-btn.active { opacity: 1; font-weight: 800; text-decoration: underline; text-decoration-color: #3b82f6; text-underline-offset: 4px; }
        
        /* Welcome Switcher Specifics */
        .welcome-lang-btn { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.3); 
            color: rgba(255,255,255,0.8);
            transition: all 0.2s ease-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .welcome-lang-btn:hover { 
            background: rgba(255,255,255,0.25); 
            color: white;
            transform: translateY(-2px);
            border-color: rgba(255,255,255,0.6);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }
        .welcome-lang-btn.active { 
            background: white; 
            color: #0f172a; 
            border-color: white; 
            font-weight: 800; 
            box-shadow: 0 0 20px rgba(255,255,255,0.4);
            transform: scale(1.05);
        }
    </style>
</head>
<body class="relative h-screen w-screen text-slate-800">

    <!-- 1. WELCOME OVERLAY -->
    <div id="welcome-overlay" class="absolute inset-0 z-[9999] bg-slate-900/95 backdrop-blur-md flex items-center justify-center text-white p-6 transition-overlay overlay-visible">
        
        <div class="max-w-5xl w-full flex flex-col items-center space-y-10 fade-in-up">
            <div class="flex flex-col md:flex-row items-center justify-center gap-8 md:gap-16 w-full">
                <div class="flex flex-col items-center gap-2 group">
                    <div class="flag-box">
                        <img src="flaggen/alt.png" alt="Historisch" class="flag-img" onerror="this.style.display='none'; this.parentElement.classList.remove('flag-box'); this.parentElement.innerHTML='<div class=\'text-xs text-slate-500 italic\'>1947</div>'">
                    </div>
                    <span class="text-[10px] uppercase tracking-widest text-slate-400 group-hover:text-slate-200 transition-colors">1947-1956</span>
                </div>
                <div class="text-center space-y-2">
                    <div class="inline-block p-4 bg-white/5 rounded-full border border-white/10 shadow-2xl mb-4"><i class="ph ph-map-trifold text-6xl text-blue-400"></i></div>
                    <h1 class="text-5xl md:text-7xl font-extrabold tracking-tight text-white">Atlas Saar</h1>
                    <div class="h-1.5 w-24 bg-gradient-to-r from-blue-500 to-purple-500 mx-auto rounded-full opacity-90"></div>
                </div>
                <div class="flex flex-col items-center gap-2 group">
                    <div class="flag-box">
                        <img src="flaggen/neu.png" alt="Aktuell" class="flag-img" onerror="this.style.display='none'; this.parentElement.classList.remove('flag-box'); this.parentElement.innerHTML='<div class=\'text-xs text-slate-500 italic\'>2024</div>'">
                    </div>
                    <span class="text-[10px] uppercase tracking-widest text-slate-400 group-hover:text-slate-200 transition-colors" data-i18n="today">Heute</span>
                </div>
            </div>
            <p class="text-xl md:text-3xl text-slate-200 leading-relaxed font-light max-w-3xl mx-auto text-center" data-i18n="intro_text">
                Wie hat die Ära der <span class="text-red-400 font-medium border-b border-red-400/30">Schwerindustrie</span> das Gesicht des <span class="text-blue-400 font-medium border-b border-blue-400/30">heutigen Saarlandes</span> geformt?
            </p>
            
            <button onclick="showTutorial()" class="mt-4 px-10 py-4 bg-white text-slate-900 rounded-full font-bold text-xl shadow-lg hover:bg-blue-50 hover:scale-105 hover:shadow-[0_0_60px_rgba(255,255,255,0.4)] transition-all transform flex items-center gap-3 mx-auto">
                <span data-i18n="btn_tutorial">Weiter zur Anleitung</span><i class="ph-bold ph-arrow-right"></i>
            </button>

            <!-- Welcome Language Switcher -->
            <div class="mt-8 flex flex-col items-center gap-3 fade-in-up" style="animation-delay: 0.2s;">
                <span class="text-[10px] uppercase tracking-widest text-slate-400 font-semibold">Sprache / Language</span>
                <div class="flex gap-3">
                    <button onclick="setLanguage('de')" id="welcome-lang-de" class="welcome-lang-btn active w-14 h-10 flex items-center justify-center rounded-lg text-sm font-bold">DE</button>
                    <button onclick="setLanguage('fr')" id="welcome-lang-fr" class="welcome-lang-btn w-14 h-10 flex items-center justify-center rounded-lg text-sm font-bold">FR</button>
                    <button onclick="setLanguage('en')" id="welcome-lang-en" class="welcome-lang-btn w-14 h-10 flex items-center justify-center rounded-lg text-sm font-bold">EN</button>
                </div>
            </div>
            
            <div class="pt-6 text-xs text-slate-500 font-mono">Version 66.0 • Link to Map</div>
        </div>
    </div>

    <!-- 2. TUTORIAL OVERLAY -->
    <div id="tutorial-overlay" class="absolute inset-0 z-[9998] bg-slate-900/95 backdrop-blur-md flex items-center justify-center text-white p-4 transition-overlay overlay-hidden">
        <div class="max-w-4xl w-full bg-white/5 rounded-3xl p-6 md:p-10 border border-white/10 shadow-2xl relative overflow-y-auto max-h-[90vh]">
            
            <h2 class="text-3xl font-bold mb-4 text-center" data-i18n="tut_title">So nutzt du den Atlas</h2>
            
            <!-- Tutorial Language Switcher -->
            <div class="mb-10 p-4 bg-slate-800/50 rounded-xl border border-slate-700/50 text-center max-w-lg mx-auto">
                <p class="text-xs text-slate-400 mb-3 uppercase tracking-wider font-semibold">
                    Sprache wählen / Choisir la langue / Choose language
                </p>
                <div class="flex justify-center gap-3">
                    <button onclick="setLanguage('de')" id="tut-lang-de" class="px-6 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg font-bold text-white transition-all border border-blue-500 shadow-lg scale-105">DE</button>
                    <button onclick="setLanguage('fr')" id="tut-lang-fr" class="px-6 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold text-slate-200 transition-all border border-slate-600">FR</button>
                    <button onclick="setLanguage('en')" id="tut-lang-en" class="px-6 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold text-slate-200 transition-all border border-slate-600">EN</button>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-10">
                <!-- Linke Spalte: Themen -->
                <div class="space-y-6">
                    <h3 class="text-lg font-bold text-blue-300 uppercase tracking-wider border-b border-white/10 pb-2 mb-4" data-i18n="tut_topic_title">
                        1. Wähle ein Thema (Oben)
                    </h3>
                    
                    <div class="flex items-start gap-4">
                        <div class="p-3 bg-slate-800 rounded-lg border border-slate-700"><i class="ph-fill ph-factory text-xl text-white"></i></div>
                        <div>
                            <div class="font-bold text-lg" data-i18n="nav_history">Berg- & Stahlbau</div>
                            <p class="text-sm text-slate-400 mt-1" data-i18n="tut_history_desc">Erkunde historische Standorte von Gruben und Hütten.</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-4">
                        <div class="p-3 bg-slate-800 rounded-lg border border-slate-700"><i class="ph-fill ph-buildings text-xl text-white"></i></div>
                        <div>
                            <div class="font-bold text-lg" data-i18n="nav_urban">Urbanisierung</div>
                            <p class="text-sm text-slate-400 mt-1" data-i18n="tut_urban_desc">Nutze den Zeitschieberegler (1926-2024).</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-4">
                        <div class="p-3 bg-slate-800 rounded-lg border border-slate-700"><i class="ph-fill ph-train text-xl text-white"></i></div>
                        <div>
                            <div class="font-bold text-lg" data-i18n="nav_transport">Verkehr</div>
                            <p class="text-sm text-slate-400 mt-1" data-i18n="tut_transport_desc">Verlauf von Bahnlinien auf alten Transportwegen.</p>
                        </div>
                    </div>
                </div>

                <!-- Rechte Spalte: Steuerung -->
                <div class="space-y-6">
                    <h3 class="text-lg font-bold text-orange-300 uppercase tracking-wider border-b border-white/10 pb-2 mb-4" data-i18n="tut_control_title">
                        2. Steuere die Ansicht (Links)
                    </h3>

                    <div class="flex items-start gap-4">
                        <div class="p-3 bg-slate-800 text-white rounded-lg border border-slate-700"><i class="ph-fill ph-map-pin text-xl"></i></div>
                        <div>
                            <div class="font-bold text-lg" data-i18n="view_details">Details</div>
                            <p class="text-sm text-slate-400 mt-1" data-i18n="tut_details_desc">Zeigt einzelne Standorte oder Bevölkerungs-Kreise an.</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-4">
                        <div class="p-3 bg-slate-800 text-slate-400 rounded-lg border border-slate-700"><i class="ph-fill ph-wave-sine text-xl"></i></div>
                        <div>
                            <div class="font-bold text-lg" data-i18n="view_overview">Übersicht</div>
                            <p class="text-sm text-slate-400 mt-1" data-i18n="tut_overview_desc">Legt Kohle- und Stahlachsen über die Karte.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hinweis und Button -->
            <div class="mt-8 pt-4 border-t border-white/10 text-center">
                <button onclick="startApp()" class="px-12 py-4 bg-blue-600 text-white rounded-full font-bold text-lg shadow-lg hover:bg-blue-500 hover:scale-105 transition-all transform flex items-center gap-2 mx-auto">
                    <span data-i18n="btn_start">Karte starten</span>
                    <i class="ph-bold ph-rocket-launch"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- LANGUAGE SWITCHER (MAIN APP) -->
    <div class="absolute top-4 right-4 z-[1001] glass-panel rounded-full px-4 py-2 flex gap-2 shadow-xl">
        <button onclick="setLanguage('de')" id="lang-de" class="lang-btn active text-sm font-bold text-slate-700 px-1">DE</button>
        <div class="w-px h-4 bg-slate-300 my-auto"></div>
        <button onclick="setLanguage('fr')" id="lang-fr" class="lang-btn text-sm font-bold text-slate-700 px-1">FR</button>
        <div class="w-px h-4 bg-slate-300 my-auto"></div>
        <button onclick="setLanguage('en')" id="lang-en" class="lang-btn text-sm font-bold text-slate-700 px-1">EN</button>
    </div>

    <!-- APP UI (NAV) -->
    <div class="absolute top-4 left-1/2 transform -translate-x-1/2 z-[1000] glass-panel rounded-full p-1.5 flex shadow-xl border border-white/40">
        <button onclick="switchMode('history')" id="btn-history" class="tab-btn active px-5 py-2.5 rounded-full text-sm font-semibold flex items-center gap-2 whitespace-nowrap"><i class="ph-fill ph-factory text-lg"></i> <span data-i18n="nav_history">Berg- & Stahlbau</span></button>
        <button onclick="switchMode('urban')" id="btn-urban" class="tab-btn px-5 py-2.5 rounded-full text-sm font-semibold flex items-center gap-2 whitespace-nowrap"><i class="ph-fill ph-buildings text-lg"></i> <span data-i18n="nav_urban">Urbanisierung</span></button>
        <button onclick="switchMode('transport')" id="btn-transport" class="tab-btn px-5 py-2.5 rounded-full text-sm font-semibold flex items-center gap-2 whitespace-nowrap"><i class="ph-fill ph-train text-lg"></i> <span data-i18n="nav_transport">Verkehr</span></button>
    </div>

    <!-- CONTROLS -->
    <div id="view-controls" class="absolute top-24 left-4 z-[1000] flex flex-col gap-2 w-auto">
        <div class="glass-panel p-2 rounded-lg shadow-lg flex gap-2">
            <button onclick="setViewMode('details')" id="view-details" class="px-3 py-1.5 rounded-md text-xs font-bold bg-slate-800 text-white shadow transition-all flex items-center gap-1"><i class="ph-fill ph-map-pin"></i> <span data-i18n="view_details">Details</span></button>
            <button onclick="setViewMode('overview')" id="view-overview" class="px-3 py-1.5 rounded-md text-xs font-bold text-slate-600 hover:bg-slate-100 transition-all flex items-center gap-1"><i class="ph-fill ph-wave-sine"></i> <span data-i18n="view_overview">Übersicht</span></button>
        </div>
    </div>

    <!-- POPULATION BOX -->
    <div id="total-pop-display" class="absolute top-36 left-4 z-[1000] glass-panel p-4 rounded-xl shadow-lg hidden w-56 border-l-4 border-blue-500 transition-all">
        <div class="text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-1" data-i18n="pop_label">Bevölkerung Saarland</div>
        <div class="text-2xl font-extrabold text-slate-800 tabular-nums" id="total-pop-value">---</div>
        <div class="text-[10px] text-slate-500 mt-1 text-right font-mono" id="total-pop-year">Jahr: 2024</div>
    </div>

    <!-- TIME SLIDER -->
    <div id="time-slider-container" class="absolute top-24 left-1/2 transform -translate-x-1/2 z-[1000] glass-panel p-5 rounded-xl shadow-xl w-80 hidden">
        <div class="flex justify-between text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-widest"><span>1926</span><span>1950</span><span>1974</span><span>2024</span></div>
        <input type="range" id="yearSlider" min="1926" max="2024" step="1" value="2024" oninput="updateUrbanMap(this.value)">
        <div class="flex justify-between items-end mt-2">
            <div class="font-bold text-2xl text-slate-800 tabular-nums" id="yearDisplay">2024</div>
            <div id="reform-badge" class="hidden text-[10px] font-bold bg-amber-100 text-amber-700 px-2 py-1 rounded border border-amber-200 reform-alert flex items-center gap-1"><i class="ph-bold ph-warning"></i> <span data-i18n="reform_label">Gebietsreform</span></div>
        </div>
    </div>

    <!-- LEGEND MIT HILFE-BUTTON -->
    <div id="legend-panel" class="absolute bottom-10 left-4 z-[1000] glass-panel p-4 rounded-xl shadow-lg max-w-[200px] hidden md:block">
        <div class="flex justify-between items-center mb-2 border-b border-slate-100 pb-1">
             <h3 class="font-bold text-[10px] text-slate-400 uppercase tracking-widest" data-i18n="legend_title">Legende</h3>
             <button onclick="showTutorial()" class="text-[10px] font-bold text-blue-500 hover:text-blue-600 transition-colors flex items-center gap-1">
                 <i class="ph-bold ph-info"></i> <span data-i18n="btn_help">Hilfe</span>
             </button>
        </div>
        <div id="legend-content" class="space-y-2.5 text-xs font-medium text-slate-700"></div>
    </div>

    <!-- SIDEBAR -->
    <div class="absolute top-24 right-4 bottom-10 w-80 z-[1000] flex flex-col pointer-events-none">
        <div class="glass-panel rounded-2xl shadow-2xl flex flex-col max-h-full pointer-events-auto overflow-hidden">
            <div class="p-5 bg-gradient-to-r from-slate-50 to-white border-b border-slate-100">
                <h2 id="sidebar-title" class="font-bold text-xl text-slate-800">Lade Daten...</h2>
                <p id="sidebar-desc" class="text-sm text-slate-500 mt-1 font-medium">Bitte warten</p>
            </div>
            <div id="sidebar-content" class="overflow-y-auto p-2 space-y-2 bg-white/60 flex-1"></div>
        </div>
    </div>

    <div id="map"></div>
    <div class="absolute bottom-0 left-0 z-[1000] bg-white/90 backdrop-blur px-4 py-1.5 text-[11px] font-medium text-slate-500 rounded-tr-xl border-t border-r border-slate-200 shadow-sm">© 2025 Atlas Saar | Daten: Stat. Amt Saarland</div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        let currentViewMode = 'details', currentMode = 'history', currentYear = 2024, currentLang = 'de';
        
        // --- i18n CONFIG ---
        const translations = {
            de: {
                today: "Heute",
                intro_text: 'Wie hat die Ära der <span class="text-red-400 font-medium border-b border-red-400/30">Schwerindustrie</span> das Gesicht des <span class="text-blue-400 font-medium border-b border-blue-400/30">heutigen Saarlandes</span> geformt?',
                btn_tutorial: "Weiter zur Anleitung",
                btn_start: "Karte starten",
                btn_help: "Hilfe",
                tut_title: "So nutzt du den Atlas",
                tut_topic_title: "1. Wähle ein Thema (Oben)",
                tut_control_title: "2. Steuere die Ansicht (Links)",
                tut_history_desc: "Erkunde historische Standorte von Gruben und Hütten.",
                tut_urban_desc: "Nutze den Zeitschieberegler (1926-2024).",
                tut_transport_desc: "Verlauf von Bahnlinien auf alten Transportwegen.",
                tut_details_desc: "Zeigt einzelne Standorte oder Bevölkerungs-Kreise an.",
                tut_overview_desc: "Legt Kohle- und Stahlachsen über die Karte.",
                nav_history: "Berg- & Stahlbau",
                nav_urban: "Urbanisierung",
                nav_transport: "Verkehr",
                view_details: "Details",
                view_overview: "Übersicht",
                pop_label: "Bevölkerung Saarland",
                year_label: "Jahr",
                reform_label: "Gebietsreform",
                legend_title: "Legende",
                sidebar_loading: "Lade Daten...",
                sidebar_wait: "Bitte warten",
                type_coal: "Kohle",
                type_steel: "Stahl",
                type_iron: "Eisen",
                type_ore: "Erz",
                sb_history_title: "Berg- und Stahlbau",
                sb_history_desc: "Kohle, Erz & Stahl",
                sb_urban_title: "Bevölkerung",
                sb_urban_desc: "1926 - 2024",
                sb_trans_title: "Schienennetz",
                sb_trans_desc: "Aktive Linien",
                more_info: "Weitere Informationen →",
                show_on_map: "Auf Karte anzeigen", // New
                border_label: "Landesgrenze",
                coal_belt: "Kohlegürtel",
                steel_axis: "Stahlachse",
                axis_note: "Industrieachsen eingeblendet",
                mining_legend: "Steinkohlebergwerk",
                steel_legend: "Stahl-/Hüttenwerk",
                analysis_struct: "<b>Strukturanalyse:</b> Die Linien zeigen die historischen Industrieachsen.",
                analysis_corr: "<b>Korrelation:</b> Bevölkerungsschwerpunkte liegen auf den Industrieachsen.",
                analysis_path: "<b>Historische Pfade:</b> Das moderne Netz folgt den alten Transportwegen."
            },
            fr: {
                today: "Aujourd'hui",
                intro_text: 'Comment l\'ère de <span class="text-red-400 font-medium border-b border-red-400/30">l\'industrie lourde</span> a-t-elle façonné le visage de la <span class="text-blue-400 font-medium border-b border-blue-400/30">Sarre d\'aujourd\'hui</span> ?',
                btn_tutorial: "Voir le tutoriel",
                btn_start: "Démarrer la carte",
                btn_help: "Aide",
                tut_title: "Comment utiliser l'atlas",
                tut_topic_title: "1. Choisissez un sujet (Haut)",
                tut_control_title: "2. Contrôlez la vue (Gauche)",
                tut_history_desc: "Explorez les sites historiques des mines et usines.",
                tut_urban_desc: "Utilisez le curseur temporel (1926-2024).",
                tut_transport_desc: "Tracé des lignes ferroviaires sur les anciennes voies.",
                tut_details_desc: "Affiche les sites individuels ou les cercles de population.",
                tut_overview_desc: "Superpose les axes du charbon et de l'acier sur la carte.",
                nav_history: "Mines & Acier",
                nav_urban: "Urbanisation",
                nav_transport: "Transports",
                view_details: "Détails",
                view_overview: "Aperçu",
                pop_label: "Population Sarre",
                year_label: "Année",
                reform_label: "Réforme territoriale",
                legend_title: "Légende",
                sidebar_loading: "Chargement...",
                sidebar_wait: "Veuillez patienter",
                type_coal: "Charbon",
                type_steel: "Acier",
                type_iron: "Fer",
                type_ore: "Minerai",
                sb_history_title: "Mines et Acier",
                sb_history_desc: "Charbon, Minerai & Acier",
                sb_urban_title: "Population",
                sb_urban_desc: "1926 - 2024",
                sb_trans_title: "Réseau ferroviaire",
                sb_trans_desc: "Lignes actives",
                more_info: "Plus d'informations →",
                show_on_map: "Afficher sur la carte", // New
                border_label: "Frontière",
                coal_belt: "Ceinture houillère",
                steel_axis: "Axe de l'acier",
                axis_note: "Axes industriels affichés",
                mining_legend: "Mine de charbon",
                steel_legend: "Usine sidérurgique",
                analysis_struct: "<b>Analyse :</b> Les lignes montrent les axes industriels historiques.",
                analysis_corr: "<b>Corrélation :</b> La population se concentre sur les axes industriels.",
                analysis_path: "<b>Chemins historiques :</b> Le réseau moderne suit les anciennes voies."
            },
            en: {
                today: "Today",
                intro_text: 'How did the era of <span class="text-red-400 font-medium border-b border-red-400/30">heavy industry</span> shape the face of <span class="text-blue-400 font-medium border-b border-blue-400/30">modern Saarland</span>?',
                btn_tutorial: "See Tutorial",
                btn_start: "Start Map",
                btn_help: "Help",
                tut_title: "How to use the Atlas",
                tut_topic_title: "1. Choose a Topic (Top)",
                tut_control_title: "2. Control View (Left)",
                tut_history_desc: "Explore historic mining and steel sites.",
                tut_urban_desc: "Use the time slider (1926-2024).",
                tut_transport_desc: "Train lines tracing old transport routes.",
                tut_details_desc: "Shows individual sites or population circles.",
                tut_overview_desc: "Overlays coal and steel axes on the map.",
                nav_history: "Mining & Steel",
                nav_urban: "Urbanization",
                nav_transport: "Transport",
                view_details: "Details",
                view_overview: "Overview",
                pop_label: "Population Saarland",
                year_label: "Year",
                reform_label: "Territorial Reform",
                legend_title: "Legend",
                sidebar_loading: "Loading...",
                sidebar_wait: "Please wait",
                type_coal: "Coal",
                type_steel: "Steel",
                type_iron: "Iron",
                type_ore: "Ore",
                sb_history_title: "Mining & Steel",
                sb_history_desc: "Coal, Ore & Steel",
                sb_urban_title: "Population",
                sb_urban_desc: "1926 - 2024",
                sb_trans_title: "Rail Network",
                sb_trans_desc: "Active Lines",
                more_info: "More Information →",
                show_on_map: "Show on map", // New
                border_label: "State Border",
                coal_belt: "Coal Belt",
                steel_axis: "Steel Axis",
                axis_note: "Industrial axes shown",
                mining_legend: "Coal Mine",
                steel_legend: "Steel/Iron Works",
                analysis_struct: "<b>Analysis:</b> The lines show historic industrial axes.",
                analysis_corr: "<b>Correlation:</b> Population centers align with industrial axes.",
                analysis_path: "<b>Historic Paths:</b> The modern network follows old transport routes."
            }
        };

        function t(key) { return translations[currentLang][key] || key; }

        function setLanguage(lang) {
            currentLang = lang;
            
            // Toggle Main UI Buttons
            document.getElementById('lang-de').classList.toggle('active', lang === 'de');
            document.getElementById('lang-fr').classList.toggle('active', lang === 'fr');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            
            // Toggle Welcome Buttons - NEW LOGIC for TILES
            ['de', 'fr', 'en'].forEach(l => {
                const wBtn = document.getElementById(`welcome-lang-${l}`);
                if(wBtn) {
                     // Toggle 'active' class
                     if (l === lang) {
                        wBtn.classList.add('active');
                     } else {
                        wBtn.classList.remove('active');
                     }
                }
            });

            // Toggle Tutorial Buttons Style (Switch active class blue vs gray)
            ['de', 'fr', 'en'].forEach(l => {
                const btn = document.getElementById(`tut-lang-${l}`);
                if(btn) {
                    if (l === lang) {
                        btn.className = "px-6 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg font-bold text-white transition-all border border-blue-500 shadow-lg scale-105";
                    } else {
                        btn.className = "px-6 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold text-slate-200 transition-all border border-slate-600";
                    }
                }
            });

            // Update static elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(translations[lang][key]) el.innerHTML = translations[lang][key];
            });

            // Re-render Views
            updateUrbanMap(document.getElementById('yearSlider').value); // Updates Pop labels
            switchMode(currentMode); // Re-renders Sidebar & Legend
        }

        // --- NAVIGATION LOGIC ---
        function showTutorial() {
            document.getElementById('welcome-overlay').classList.remove('overlay-visible');
            document.getElementById('welcome-overlay').classList.add('overlay-hidden');
            const tut = document.getElementById('tutorial-overlay');
            tut.classList.remove('overlay-hidden');
            tut.classList.add('overlay-visible');
        }

        function startApp() {
            const tut = document.getElementById('tutorial-overlay');
            tut.classList.remove('overlay-visible');
            tut.classList.add('overlay-hidden');
            setTimeout(() => map.flyTo([49.38, 6.98], 10.5, { duration: 2.5 }), 300);
        }

        // FALLBACK GRENZE (Leer, da GeoJSON)
        const fallbackBorder = []; 

        const saarlandPopData = {1926:769300,1927:772700,1930:794500,1935:814576,1939:824000,1946:857630,1950:948716,1955:996238,1960:1060493,1965:1127354,1970:1121300,1974:1103255,1980:1066299,1985:1045936,1990:1072963,1995:1084370,2000:1068703,2005:1050293,2010:1017567,2015:995597,2020:983991,2024:1012141};
        const overviewLines = { mining: {name:"Kohlegürtel",color:"#ef4444",path:[[49.180,6.800],[49.250,6.850],[49.290,6.980],[49.310,7.060],[49.350,7.120],[49.370,7.250]]}, steel: {name:"Stahlachse",color:"#475569",path:[[49.350,6.740],[49.250,6.840],[49.240,6.940],[49.220,7.030],[49.280,7.120],[49.345,7.180],[49.325,7.335]]}};

        // Helper to handle bilingual text in data
        function getLangText(obj) {
            if (typeof obj === 'string') return obj;
            return obj[currentLang] || obj['de'];
        }

        // EXPANDED HISTORICAL DATA
        const historyData={
            mines:[
                {
                    id:"m1",name:"Bergwerk Saar / Ensdorf",coords:[49.3188,6.7780],type:"Kohle",period:"1833-2012",
                    desc:{
                        de:"Ensdorf war das letzte aktive Kohlebergwerk des Saarlandes. Mit der Schließung am 30. Juni 2012 endete eine jahrhundertelange Ära. Der Hauptschacht 'Duhamel' wurde 2016 mit dem imposanten 'Saarpolygon' gekrönt – einer begehbaren Großskulptur, die heute als Symbol für den Strukturwandel weit über die Landesgrenzen hinaus bekannt ist.",
                        fr:"Ensdorf était la dernière mine de charbon active de la Sarre. Avec sa fermeture le 30 juin 2012, une ère séculaire s'est achevée. Le puits principal 'Duhamel' est surmonté depuis 2016 par l'imposant 'Polygone de la Sarre' – une grande sculpture accessible qui symbolise aujourd'hui le changement structurel bien au-delà des frontières régionales.",
                        en:"Ensdorf was the last active coal mine in Saarland. Its closure on June 30, 2012, marked the end of a centuries-old era. The main shaft 'Duhamel' was crowned in 2016 with the imposing 'Saar Polygon' – a walkable large-scale sculpture that now stands as a widely recognized symbol of structural change."
                    }, 
                    img:"img/ensdorf.jpg", copyright:"Foto: Josef Dernbercher"
                },
                {
                    id:"m2",name:"Grube Göttelborn",coords:[49.3548,7.0335],type:"Kohle",period:"1887-2000",
                    desc:{
                        de:"Göttelborn galt als Musterzeche und war eine der modernsten Gruben Europas. Bekannt als der 'Weiße Riese' wegen ihrer hellen Fördergerüste und Gebäude. Nach der Stilllegung im Jahr 2000 wurde das Gelände in einen 'Industriekultur-Campus' und Solarpark umgewandelt. Der markante Förderturm von Schacht IV ist mit 90 Metern das höchste Fördergerüst des Reviers.",
                        fr:"Göttelborn était considérée comme une mine modèle et l'une des plus modernes d'Europe. Connue sous le nom de 'Géant Blanc' en raison de ses chevalements et bâtiments clairs. Après sa fermeture en 2000, le site a été transformé en 'Campus de la culture industrielle' et en parc solaire. La tour d'extraction marquante du puits IV est, avec ses 90 mètres, la plus haute de la région.",
                        en:"Göttelborn was considered a model mine and one of the most modern in Europe. Known as the 'White Giant' due to its bright headframes and buildings. After closing in 2000, the site was converted into an 'Industrial Culture Campus' and solar park. The striking winding tower of Shaft IV, at 90 meters, is the tallest headframe in the mining district."
                    },
                    img:"img/goettelborn.jpg", copyright:"Foto: Mark Scheider"
                },
                {
                    id:"m3",name:"Grube Reden",coords:[49.3493,7.1132],type:"Kohle",period:"1846-1995",
                    desc:{
                        de:"Die Grube Reden in Schiffweiler war für ihre hochwertige Fettkohle bekannt. Heute ist das Gelände Standort des Freizeitparks 'Gondwana - Das Praehistorium'. Die ehemaligen Absinkweiher wurden in beeindruckende Wassergärten verwandelt. Architektonisch besticht die Anlage durch ihre Gebäude aus rotem Sandstein im Stil des Historismus.",
                        fr:"La mine Reden à Schiffweiler était célèbre pour son charbon gras de haute qualité. Aujourd'hui, le site abrite le parc de loisirs 'Gondwana - Le Praehistorium'. Les anciens bassins de décantation ont été transformés en impressionnants jardins d'eau. L'architecture du site séduit par ses bâtiments en grès rouge de style historiciste.",
                        en:"The Reden mine in Schiffweiler was famous for its high-quality bituminous coal. Today, the site hosts the 'Gondwana - The Praehistorium' theme park. The former settling ponds have been transformed into impressive water gardens. Architecturally, the complex is striking for its red sandstone buildings in the Historicist style."
                    },
                    img:"img/reden.jpg", copyright:"Foto: Alain Meier"
                },
                {
                    id:"m4",name:"Grube Camphausen",coords:[49.3065,7.0074],type:"Kohle",period:"1871-1990",
                    desc:{
                        de:"Benannt nach dem preußischen Finanzminister Ludolf Camphausen. Die Grube ist berühmt für ihren architektonisch einzigartigen Hammerkopfturm aus Stahlbeton über Schacht IV, der 1911/12 als erster seiner Art weltweit errichtet wurde. Die Anlage steht heute unter Denkmalschutz und prägt die Silhouette des Fischbachtals.",
                        fr:"Nommée d'après le ministre des finances prussien Ludolf Camphausen. La mine est célèbre pour sa tour en forme de marteau en béton armé au-dessus du puits IV, unique sur le plan architectural et construite en 1911/12 comme la première du genre au monde. Le site est aujourd'hui classé monument historique et marque la silhouette de la vallée de Fischbach.",
                        en:"Named after Prussian Finance Minister Ludolf Camphausen. The mine is famous for its architecturally unique reinforced concrete hammerhead tower over Shaft IV, built in 1911/12 as the first of its kind worldwide. The site is now a protected monument and defines the silhouette of the Fischbach Valley."
                    },
                    img:"img/camphausen.jpg", copyright:"Foto: Flocci Nivis"
                },
                {
                    id:"m5",name:"Grube Luisenthal",coords:[49.2477,6.8938],type:"Kohle",period:"1820-2005",
                    desc:{
                        de:"Einst das tiefste Bergwerk an der Saar. Traurige Berühmtheit erlangte Luisenthal durch das schwerste Grubenunglück in der Geschichte der Bundesrepublik: Am 7. Februar 1962 kamen bei einer Schlagwetterexplosion 299 Bergleute ums Leben. Eine Gedenkstätte erinnert heute an die Opfer. In späteren Jahren wurde Luisenthal mit dem Bergwerk Warndt zum Verbundbergwerk zusammengelegt.",
                        fr:"Autrefois la mine la plus profonde de la Sarre. Luisenthal a acquis une triste notoriété à cause de la plus grave catastrophe minière de l'histoire de la République fédérale : le 7 février 1962, 299 mineurs ont péri dans une explosion de grisou. Un mémorial rappelle aujourd'hui les victimes. Plus tard, Luisenthal a été fusionnée avec la mine Warndt.",
                        en:"Once the deepest mine on the Saar. Luisenthal gained sad notoriety due to the worst mining accident in the history of the Federal Republic: on February 7, 1962, 299 miners died in a firedamp explosion. A memorial commemorates the victims today. In later years, Luisenthal was merged with the Warndt mine."
                    },
                    img:"img/luisenthal.jpg", copyright:"Foto: LoKiLeCh"
                },
                {
                    id:"m6",name:"Grube Warndt",coords:[49.1864,6.8097],type:"Kohle",period:"1963-2005",
                    desc:{
                        de:"Das jüngste Großbergwerk des Reviers, 1963 in Betrieb genommen, um die reichen Vorkommen unter dem Warndtwald zu erschließen. Es war hochmechanisiert und später über einen 7 km langen Förderstollen mit der Grube Luisenthal verbunden. Nach der Stilllegung wurden die Schächte verfüllt; die Tagesanlagen wurden weitgehend zurückgebaut.",
                        fr:"La plus jeune grande mine de la région, mise en service en 1963 pour exploiter les riches gisements sous la forêt du Warndt. Elle était hautement mécanisée et plus tard reliée à la mine Luisenthal par une galerie de 7 km. Après la fermeture, les puits ont été comblés ; les installations de surface ont été largement démantelées.",
                        en:"The youngest major mine in the district, commissioned in 1963 to access rich deposits under the Warndt forest. It was highly mechanized and later connected to the Luisenthal mine via a 7 km long tunnel. After shutdown, the shafts were backfilled; the surface facilities were largely dismantled."
                    },
                    img:"img/warndt.jpg", copyright:"Foto: Ducky88"
                },
                {
                    id:"m7",name:"Grube Velsen",coords:[49.2219,6.8363],type:"Kohle",period:"1899-2005",
                    desc:{
                        de:"Velsen ist heute ein beliebtes Erlebnisbergwerk. Besucher können hier unter Führung ehemaliger Bergleute Technik zum Anfassen erleben. Legendär ist die 'Kaffeeküche', ein riesiger Saal für die Pausen der Belegschaft. Der Gustav-Schacht II besitzt eines der seltenen Doppelbock-Fördergerüste.",
                        fr:"Velsen est aujourd'hui une mine d'aventure populaire. Les visiteurs peuvent y découvrir la technologie de près, guidés par d'anciens mineurs. La 'cuisine à café', une immense salle pour les pauses du personnel, est légendaire. Le puits Gustav II possède l'un des rares chevalements à double béquille.",
                        en:"Velsen is now a popular adventure mine. Visitors can experience hands-on technology guided by former miners. The 'coffee kitchen', a huge hall for staff breaks, is legendary. The Gustav Shaft II has one of the rare double-trestle headframes."
                    },
                    img:"img/velsen.jpg", copyright:"Foto: Unbekannt"
                },
                {
                    id:"m8",name:"Grube Itzenplitz",coords:[49.3542,7.0869],type:"Kohle",period:"1856-1960",
                    desc:{
                        de:"Malerisch am Itzenplitzer Weiher gelegen. Die Grube besitzt das älteste erhaltene Fördergerüst des Saarlandes (Schacht II), eine filigrane Stahlkonstruktion. Der Weiher wurde ursprünglich zur Wasserversorgung der Dampfmaschinen angelegt und ist heute ein Naherholungsgebiet.",
                        fr:"Pittoresquement située près de l'étang d'Itzenplitz. La mine possède le plus ancien chevalement conservé de la Sarre (puits II), une construction en acier filigrane. L'étang a été créé à l'origine pour alimenter les machines à vapeur en eau et est aujourd'hui une zone de loisirs.",
                        en:"Picturesquely located by the Itzenplitz Pond. The mine has the oldest preserved headframe in Saarland (Shaft II), a filigree steel structure. The pond was originally created to supply water for steam engines and is now a recreation area."
                    },
                    img:"img/itzeplitz.jpg", copyright:"Foto: Elmar Ersch"
                },
                {
                    id:"m9",name:"Grube Dechen",coords:[49.3378,7.1722],type:"Kohle",period:"1854-1968",
                    desc:{
                        de:"Die Grube Dechen war strategisch wichtig für die direkte Versorgung des benachbarten Neunkircher Eisenwerks mit Koks. Sie wurde nach dem preußischen Oberberghauptmann Heinrich von Dechen benannt. Viele ihrer Stollen reichten bis unter das Stadtgebiet von Neunkirchen.",
                        fr:"La mine Dechen était stratégiquement importante pour l'approvisionnement direct en coke de l'usine sidérurgique voisine de Neunkirchen. Elle a été nommée d'après le capitaine des mines prussien Heinrich von Dechen. Beaucoup de ses galeries s'étendaient sous la ville de Neunkirchen.",
                        en:"The Dechen mine was strategically important for directly supplying coke to the neighboring Neunkirchen ironworks. It was named after Prussian chief mining captain Heinrich von Dechen. Many of its tunnels extended beneath the city of Neunkirchen."
                    },
                    img:"img/dechen.jpg", copyright:"Foto: Zecke64"
                },
                {
                    id:"m10",name:"Grube Heinitz",coords:[49.3300,7.1300],type:"Kohle",period:"1847-1964",
                    desc:{
                        de:"Heinitz war eine der bedeutendsten Staatsgruben Preußens an der Saar. Benannt nach Minister Friedrich Anton von Heinitz. Die Grube war technologisch oft Vorreiter und besaß umfangreiche Kokereianlagen. Nach der Schließung 1964 wurden viele Flächen renaturiert.",
                        fr:"Heinitz était l'une des plus importantes mines d'État prussiennes de la Sarre. Nommée d'après le ministre Friedrich Anton von Heinitz. La mine était souvent pionnière technologique et possédait de vastes cokeries. Après la fermeture en 1964, de nombreuses zones ont été renaturées.",
                        en:"Heinitz was one of Prussia's most important state mines on the Saar. Named after Minister Friedrich Anton von Heinitz. The mine was often a technological pioneer and possessed extensive coking plants. After closing in 1964, many areas were renatured."
                    },
                    img:"img/heinitz.jpg", copyright:"Foto: Gripweed"
                },
                {
                    id:"m11",name:"Grube König",coords:[49.3450,7.1750],type:"Kohle",period:"1820-1968",
                    desc:{
                        de:"Mitten im Herzen von Neunkirchen gelegen, war diese Grube untrennbar mit der Stadtgeschichte verbunden. Sie lieferte nicht nur Kohle für die Hütte, sondern prägte auch die soziale Struktur durch ihre Arbeitersiedlungen. Der König-Schacht war lange Zeit eines der Wahrzeichen der Stadt.",
                        fr:"Située au cœur de Neunkirchen, cette mine était indissociable de l'histoire de la ville. Elle fournissait non seulement du charbon pour l'usine, mais façonnait aussi la structure sociale grâce à ses cités ouvrières. Le puits König a longtemps été l'un des emblèmes de la ville.",
                        en:"Located right in the heart of Neunkirchen, this mine was inextricably linked to the city's history. It not only supplied coal for the ironworks but also shaped the social structure through its workers' settlements. The König shaft was a city landmark for a long time."
                    },
                    img:"img/koenig.jpg", copyright:"Foto: Carl Heinrich Jacobi"
                },
                {
                    id:"m12",name:"Grube Frankenholz",coords:[49.3702,7.2405],type:"Kohle",period:"1879-1959",
                    desc:{
                        de:"Frankenholz war zeitweise die tiefste Grube der bayerischen Pfalz (zu der das Gebiet damals gehörte). Sie war bekannt für schwierige geologische Bedingungen und Schlagwettergefahren. Ihr markanter Beton-Förderturm wurde in den 1930ern errichtet und ist heute ein Denkmal.",
                        fr:"Frankenholz fut par moments la mine la plus profonde du Palatinat bavarois (auquel la zone appartenait alors). Elle était connue pour ses conditions géologiques difficiles et ses risques de grisou. Sa tour d'extraction en béton marquante a été construite dans les années 1930 et est aujourd'hui un monument.",
                        en:"Frankenholz was at times the deepest mine in the Bavarian Palatinate (to which the area belonged then). It was known for difficult geological conditions and firedamp hazards. Its distinctive concrete winding tower was built in the 1930s and is a monument today."
                    },
                    img:"img/frankenholz.jpg", copyright:"Foto: Unbekannt"
                },
                {
                    id:"m13",name:"Grube St. Ingbert",coords:[49.2830,7.1180],type:"Kohle",period:"1852-1959",
                    desc:{
                        de:"Die Steinkohlegewinnung in St. Ingbert reicht bis ins 15. Jahrhundert zurück. Das Herzstück heute ist das Besucherbergwerk 'Rischbachstollen', wo man die harte Arbeit der Bergleute authentisch nacherleben kann. Die Grube war entscheidend für die Industrialisierung der Stadt.",
                        fr:"L'extraction de houille à St. Ingbert remonte au 15ème siècle. Le cœur du site est aujourd'hui la mine touristique 'Rischbachstollen', où l'on peut revivre authentiquement le dur labeur des mineurs. La mine a été décisive pour l'industrialisation de la ville.",
                        en:"Coal mining in St. Ingbert dates back to the 15th century. The centerpiece today is the 'Rischbach Tunnel' visitor mine, where one can authentically experience the miners' hard work. The mine was crucial for the city's industrialization."
                    },
                    img:"img/inbert.jpg", copyright:"Foto: Christian Bohr"
                },
                {
                    id:"m14",name:"Grube Maybach",coords:[49.3205,7.0632],type:"Kohle",period:"1873-1964",
                    desc:{
                        de:"Benannt nach Albert von Maybach. Die Grube im Ortsteil Friedrichsthal war Schauplatz eines schweren Unglücks im Jahr 1930. Bekannt ist sie auch für den 'Marie-Juchacz-Schacht'. Die Siedlung Maybach wurde als eigenständige Werkssiedlung im Wald angelegt und steht heute unter Ensembleschutz.",
                        fr:"Nommée d'après Albert von Maybach. La mine dans le quartier de Friedrichsthal a été le théâtre d'un grave accident en 1930. Elle est aussi connue pour le puits 'Marie-Juchacz'. La cité Maybach a été aménagée comme une cité ouvrière autonome dans la forêt et est aujourd'hui classée ensemble protégé.",
                        en:"Named after Albert von Maybach. The mine in the Friedrichsthal district was the site of a severe accident in 1930. It is also known for the 'Marie Juchacz Shaft'. The Maybach settlement was built as an independent company town in the forest and is now a protected ensemble."
                    },
                    img:"img/maybach.jpg", copyright:"Foto: Unbekannt"
                },
                {
                    id:"m15",name:"Grube Viktoria",coords:[49.2927,6.8882],type:"Kohle",period:"1866-1963",
                    desc:{
                        de:"Gelegen in Püttlingen, oft als 'Köllertal-Metropole' bezeichnet. Die Grube Viktoria war prägend für die Region. Ein architektonisches Highlight ist das Zechenhaus, das wegen seiner sakralen Anmutung auch 'Kathedrale der Arbeit' genannt wird und heute für kulturelle Zwecke genutzt wird.",
                        fr:"Située à Püttlingen, souvent appelée 'Métropole de la vallée de Köller'. La mine Viktoria a marqué la région. Un point fort architectural est le bâtiment de la mine, appelé 'Cathédrale du Travail' en raison de son allure sacrée, aujourd'hui utilisé à des fins culturelles.",
                        en:"Located in Püttlingen, often called the 'Köllertal Metropolis'. The Viktoria mine shaped the region. An architectural highlight is the mine building, called the 'Cathedral of Work' due to its sacral appearance, now used for cultural purposes."
                    },
                    img:"img/viktoria.jpg", copyright:"Foto: Kallewirsch"
                },
                {
                    id:"m16",name:"Grube Von der Heydt",coords:[49.2688,6.9575],type:"Kohle",period:"1850-1965",
                    desc:{
                        de:"Benannt nach dem legendären Bankier und preußischen Handelsminister August von der Heydt. Die Grube liegt idyllisch mitten im Saarbrücker Stadtwald (Burbacher Wald). Besonders bemerkenswert ist die zugehörige Arbeitersiedlung, die fast unverändert erhalten ist und als Gartenstadt-Modell gilt.",
                        fr:"Nommée d'après le légendaire banquier et ministre du commerce prussien August von der Heydt. La mine est idéalement située au milieu de la forêt urbaine de Sarrebruck. La cité ouvrière associée est particulièrement remarquable, conservée presque intacte et considérée comme un modèle de cité-jardin.",
                        en:"Named after the legendary banker and Prussian Trade Minister August von der Heydt. The mine is beautifully located in the middle of the Saarbrücken city forest. Particularly noteworthy is the associated workers' settlement, preserved almost unchanged and considered a garden city model."
                    },
                    img:"img/heydt.jpg", copyright:"Foto: Unbekannt"
                },
                {
                    id:"m17",name:"Grube Jägersfreude",coords:[49.2610,7.0050],type:"Kohle",period:"1856-1968",
                    desc:{
                        de:"Im Volksmund 'Blechhammer' genannt. Jägersfreude liegt im Sulzbachtal und war direkt an die Eisenbahnlinie angeschlossen. Nach der Stilllegung blieben Teile der Tagesanlagen erhalten und wurden gewerblich genutzt. Die Halde der Grube ist heute ein beliebter Aussichtspunkt.",
                        fr:"Surnommée 'Blechhammer'. Jägersfreude est située dans la vallée de Sulzbach et était directement reliée à la ligne de chemin de fer. Après la fermeture, des parties des installations de surface ont été conservées et utilisées commercialement. Le terril de la mine est aujourd'hui un point de vue populaire.",
                        en:"Nickname 'Blechhammer'. Jägersfreude is located in the Sulzbach Valley and was directly connected to the railway line. After closing, parts of the surface facilities were preserved and used commercially. The mine dump is now a popular viewpoint."
                    },
                    img:"img/jaegersfreude.jpg", copyright:"Foto: Flocci Nivis"
                },
                {
                    id:"m18",name:"Grube Kohlwald",coords:[49.3680,7.1980],type:"Kohle",period:"1842-1966",
                    desc:{
                        de:"Die Grube Kohlwald bei Wiebelskirchen lag in einem Waldgebiet an der Grenze zu Bayern (Pfalz). Sie baute zeitweise auch Flöze ab, die eigentlich auf bayerischem Gebiet lagen (durch einen Staatsvertrag geregelt). Bekannt für ihre schwierige Wasserhaltung.",
                        fr:"La mine Kohlwald près de Wiebelskirchen était située dans une zone forestière à la frontière avec la Bavière (Palatinat). Elle exploitait parfois des veines situées en territoire bavarois (régi par un traité d'État). Connue pour sa gestion difficile de l'eau.",
                        en:"The Kohlwald mine near Wiebelskirchen was located in a forest area on the border with Bavaria (Palatinate). It occasionally mined seams actually located in Bavarian territory (regulated by a state treaty). Known for its difficult water management."
                    },
                    img:"img/kohlwald.jpg", copyright:"Foto: Georg Diancourt"
                },
                {
                    id:"m19",name:"Grube Hirschbach",coords:[49.2850,7.0450],type:"Kohle",period:"1816-1950",
                    desc:{
                        de:"Eine der ältesten Gruben im Raum Dudweiler. Sie war bekannt für den Einsatz der ersten Dampfmaschinen im Revier. Nach ihrer Stilllegung dienten Teile der Stollen als Lehrbergwerk und später zur Bewetterung der Grube Jägersfreude.",
                        fr:"Une des plus anciennes mines de la région de Dudweiler. Elle était connue pour l'utilisation des premières machines à vapeur de la région. Après sa fermeture, des parties des galeries ont servi de mine école et plus tard à l'aération de la mine Jägersfreude.",
                        en:"One of the oldest mines in the Dudweiler area. It was known for using the first steam engines in the district. After its closure, parts of the tunnels served as a training mine and later for ventilating the Jägersfreude mine."
                    },
                    img:"img/hirschbach.jpg", copyright:"Foto: Zecke64"
                },
                {
                    id:"m26",name:"Grube Altenwald",coords:[49.3100,7.0800],type:"Kohle",period:"1851-1932",
                    desc:{
                        de:"Gelegen im gleichnamigen Stadtteil von Sulzbach. Obwohl die Förderung bereits 1932 endete, prägte sie den Ort nachhaltig. Die Grube litt stark unter der Weltwirtschaftskrise, was zu ihrer frühen Schließung führte.",
                        fr:"Située dans le quartier du même nom à Sulzbach. Bien que l'extraction ait cessé dès 1932, elle a durablement marqué le lieu. La mine a beaucoup souffert de la crise économique mondiale, ce qui a conduit à sa fermeture précoce.",
                        en:"Located in the district of the same name in Sulzbach. Although mining ended as early as 1932, it left a lasting mark on the town. The mine suffered greatly during the Great Depression, leading to its early closure."
                    },
                    img:"img/altenwald.jpg", copyright:"Foto: Unbekannt"
                },
                {
                    id:"m29",name:"Grube Reisbach",coords:[49.3800,6.9000],type:"Kohle",period:"1962-2000",
                    desc:{
                        de:"Eine Besonderheit im Saarbergbau: Es war keine Staatsgrube, sondern eine Privatgrube im Besitz der Unternehmerfamilie Dr. Arnold Schäfer. Sie förderte bis ins Jahr 2000 und war damit eine der langlebigsten Privatgruben Deutschlands.",
                        fr:"Une particularité dans les mines sarroises : ce n'était pas une mine d'État, mais une mine privée appartenant à la famille d'entrepreneurs Dr. Arnold Schäfer. Elle a produit jusqu'en 2000, ce qui en fait l'une des mines privées les plus durables d'Allemagne.",
                        en:"A curiosity in Saar mining: it was not a state mine, but a private mine owned by the entrepreneur family Dr. Arnold Schäfer. It mined until 2000, making it one of Germany's longest-lasting private mines."
                    },
                    img:"img/reisbach.jpg", copyright:"Foto: Flocci Nivis"
                },
                {
                    id:"m30",name:"Grube Hostenbach",coords:[49.2600,6.7800],type:"Kohle",period:"1750-1932",
                    desc:{
                        de:"Hostenbach war eine der ältesten Gruben des Landes, bereits im 18. Jahrhundert erwähnt. Sie lag in der Gemeinde Wadgassen. Interessant ist ihre Verbindung zur lokalen Glas- und Eisenindustrie, die sie mit Brennstoff versorgte.",
                        fr:"Hostenbach était l'une des plus anciennes mines du pays, mentionnée dès le 18ème siècle. Elle était située dans la commune de Wadgassen. Sa connexion avec l'industrie locale du verre et du fer, qu'elle alimentait en carburant, est intéressante.",
                        en:"Hostenbach was one of the oldest mines in the state, mentioned as early as the 18th century. It was located in the municipality of Wadgassen. Interesting is its connection to the local glass and iron industry, which it supplied with fuel."
                    },
                    img:"img/hostenbach.jpg", copyright:"Foto: Zecke64"
                },
                {
                    id:"m31",name:"Grube Mellin",coords:[49.3050,7.0650],type:"Kohle",period:"1856-1932",
                    desc:{
                        de:"Diese Sulzbacher Grube ist berühmt für ihr neugotisches Bauensemble, insbesondere den Förderturm, der an einen Burgfried erinnert. Die 'Mellin-Velsen'-Schachtanlage gilt als eines der schönsten Beispiele für die Industriearchitektur des 19. Jahrhunderts.",
                        fr:"Cette mine de Sulzbach est célèbre pour son ensemble architectural néo-gothique, notamment la tour d'extraction qui rappelle un donjon. Le complexe 'Mellin-Velsen' est considéré comme l'un des plus beaux exemples d'architecture industrielle du 19ème siècle.",
                        en:"This Sulzbach mine is famous for its neo-Gothic building ensemble, especially the winding tower which resembles a castle keep. The 'Mellin-Velsen' complex is considered one of the finest examples of 19th-century industrial architecture."
                    },
                    img:"img/mellin.jpg", copyright:"Foto: Flocci Nivis"
                }
            ],
            steel:[
                {
                    id:"s1",name:"Völklinger Hütte",coords:[49.2485,6.8442],type:"Stahl",period:"UNESCO",
                    desc:{
                        de:"Die Völklinger Hütte ist das weltweit einzige vollständig erhaltene Eisenwerk aus der Blütezeit der Industrialisierung und seit 1994 UNESCO-Weltkulturerbe. Zu besichtigen sind die riesigen Hochöfen, die Gebläsehalle mit ihren gigantischen Schwungrädern und die Sinteranlage. Heute ist sie ein internationaler Ort für Ausstellungen und Konzerte.",
                        fr:"L'usine sidérurgique de Völklingen est la seule usine sidérurgique entièrement conservée au monde datant de l'âge d'or de l'industrialisation et est classée au patrimoine mondial de l'UNESCO depuis 1994. On peut y visiter les immenses hauts fourneaux, la salle des soufflantes et l'usine d'agglomération. C'est aujourd'hui un lieu international d'expositions et de concerts.",
                        en:"The Völklingen Ironworks is the world's only fully preserved ironworks from the peak of industrialization and has been a UNESCO World Heritage Site since 1994. Visitors can view the huge blast furnaces, the blower hall with its gigantic flywheels, and the sintering plant. Today it is an international venue for exhibitions and concerts."
                    },
                    img:"img/voelklingen.jpg", copyright:"Foto: TeKaBe"
                },
                {
                    id:"s2",name:"Dillinger Hütte",coords:[49.3480,6.7450],type:"Stahl",period:"Aktiv",
                    desc:{
                        de:"Gegründet 1685, ist die Dillinger Hütte das älteste noch produzierende Stahlunternehmen im Saarland. Sie ist ein Weltmarktführer für hochwertige Grobbleche, die u.a. für Pipelines, Brücken und Windkraftanlagen (Offshore) verwendet werden. Die Hochöfen prägen das Stadtbild von Dillingen.",
                        fr:"Fondée en 1685, la Dillinger Hütte est la plus ancienne entreprise sidérurgique encore en activité en Sarre. Elle est un leader mondial des tôles fortes de haute qualité, utilisées pour les pipelines, les ponts et les éoliennes (offshore). Les hauts fourneaux marquent le paysage urbain de Dillingen.",
                        en:"Founded in 1685, Dillinger Hütte is the oldest still-producing steel company in Saarland. It is a global market leader for high-quality heavy plates used for pipelines, bridges, and wind turbines (offshore). The blast furnaces dominate the cityscape of Dillingen."
                    },
                    img:"img/dillingen.jpg", copyright:"Foto: Borchel"
                },
                {
                    id:"s3",name:"Neunkircher Eisenwerk",coords:[49.3455,7.1780],type:"Stahl",period:"1593-1982",
                    desc:{
                        de:"Das Werk dominierte jahrhundertelang die 'Stadt aus Eisen und Kohle'. Es lag mitten im Stadtzentrum. Nach der Stilllegung 1982 wurden die meisten Anlagen abgerissen, doch Relikte wie die Hochofengruppe und der riesige Gasometer blieben als Industriedenkmäler erhalten und wurden in das 'Alte Hüttenareal' integriert.",
                        fr:"L'usine a dominé pendant des siècles la 'ville de fer et de charbon'. Elle était située en plein centre-ville. Après la fermeture en 1982, la plupart des installations ont été démolies, mais des reliques comme le groupe de hauts fourneaux et l'immense gazomètre ont été conservées et intégrées dans l''Ancienne zone sidérurgique'.",
                        en:"The works dominated the 'City of Iron and Coal' for centuries. It was located right in the city center. After closing in 1982, most facilities were demolished, but relics like the blast furnace group and the huge gasometer were preserved as industrial monuments and integrated into the 'Old Ironworks Area'."
                    },
                    img:"img/neunkirchen.jpg", copyright:"Foto: Pierre Lemoine"
                },
                {
                    id:"s4",name:"Halberger Hütte",coords:[49.2180,7.0300],type:"Stahl",period:"Aktiv",
                    desc:{
                        de:"Gelegen am Fuße des Halbergs in Brebach. Die Hütte blickt auf eine lange Tradition seit 1756 zurück. Heute gehört sie zur Saint-Gobain-Gruppe und ist spezialisiert auf duktile Gussrohre für die Wasserversorgung sowie Motorenteile. Ein wichtiges Beispiel für die noch lebendige Industrie.",
                        fr:"Située au pied du Halberg à Brebach. L'usine a une longue tradition remontant à 1756. Aujourd'hui, elle appartient au groupe Saint-Gobain et est spécialisée dans les tuyaux en fonte ductile pour l'approvisionnement en eau ainsi que les pièces de moteur. Un exemple important de l'industrie encore vivante.",
                        en:"Located at the foot of the Halberg in Brebach. The works look back on a long tradition since 1756. Today it belongs to the Saint-Gobain group and specializes in ductile iron pipes for water supply and engine parts. An important example of still-active industry."
                    },
                    img:"img/halberg.jpg", copyright:"Foto: AnRo0002"
                },
                {
                    id:"s5",name:"Burbacher Hütte",coords:[49.2420,6.9350],type:"Stahl",period:"Aktiv",
                    desc:{
                        de:"Die Burbacher Hütte in Saarbrücken entstand 1856. Sie ist heute ein Standort von Saarstahl und bekannt für ihre Drahtstraße. Das Werk prägte den Stadtteil Burbach massiv, der als klassisches Arbeiterviertel wuchs. Die Silhouette der Werkhallen ist von der Autobahn und der Saar aus gut sichtbar.",
                        fr:"L'usine de Burbach à Sarrebruck a été créée en 1856. C'est aujourd'hui un site de Saarstahl, connu pour son train à fil. L'usine a massivement façonné le quartier de Burbach, qui s'est développé comme un quartier ouvrier classique. La silhouette des halles est bien visible depuis l'autoroute et la Sarre.",
                        en:"The Burbach Ironworks in Saarbrücken was established in 1856. It is now a Saarstahl site, known for its wire rod mill. The works massively shaped the Burbach district, which grew as a classic working-class neighborhood. The silhouette of the factory halls is clearly visible from the highway and the Saar river."
                    },
                    img:"img/burbach.jpg", copyright:"Foto: NobbiP"
                },
                {
                    id:"s6",name:"Alte Schmelz",coords:[49.2750,7.1050],type:"Eisen",period:"1733-1991",
                    desc:{
                        de:"Ein bedeutendes Industriedenkmal in St. Ingbert. Hier wurde seit 1733 Eisen verhüttet. Das Ensemble aus Arbeiterhäusern ('Möllerhalle') und Verwaltungsgebäuden ist gut erhalten. Heute wird das Gelände oft für Kulturveranstaltungen genutzt und ist ein wichtiger Teil der saarländischen Industriegeschichte.",
                        fr:"Un monument industriel important à St. Ingbert. Le fer y était fondu depuis 1733. L'ensemble des maisons ouvrières ('Möllerhalle') et des bâtiments administratifs est bien conservé. Aujourd'hui, le site est souvent utilisé pour des événements culturels et fait partie intégrante de l'histoire industrielle de la Sarre.",
                        en:"An important industrial monument in St. Ingbert. Iron has been smelted here since 1733. The ensemble of workers' houses ('Möllerhalle') and administrative buildings is well preserved. Today the site is often used for cultural events and is an important part of Saarland's industrial history."
                    },
                    img:"img/schmelz.jpg", copyright:"Foto: Conny Liegl"
                },
                {
                    id:"s7",name:"Eisenwerk Homburg",coords:[49.3250,7.3350],type:"Eisen",period:"19. Jh.",
                    desc:{
                        de:"Homburg spielte eine Schlüsselrolle in der pfälzisch-saarländischen Eisenindustrie. Das Werk profitierte von der frühen Bahnanbindung. Später entwickelte sich Homburg mehr zu einem Standort für verarbeitende Industrie und Automobilzulieferer (Bosch, Michelin), was die Wurzeln in der Metallverarbeitung widerspiegelt.",
                        fr:"Homburg a joué un rôle clé dans l'industrie du fer palatino-sarroise. L'usine a profité de la connexion ferroviaire précoce. Plus tard, Homburg s'est davantage développée comme un site pour l'industrie manufacturière et les fournisseurs automobiles, reflétant ses racines dans le travail des métaux.",
                        en:"Homburg played a key role in the Palatinate-Saar iron industry. The works benefited from the early railway connection. Later, Homburg developed more into a location for manufacturing industries and automotive suppliers, reflecting its roots in metalworking."
                    },
                    img:"img/homburg.jpg", copyright:"Foto: Bezirksamt rentamt"
                },
                {
                    id:"s8",name:"Mariahütte",coords:[49.6050,6.9650],type:"Eisen",period:"ab 17. Jh.",
                    desc:{
                        de:"Gelegen im Hochwald (Nonnweiler-Otzenhausen). Die Mariahütte zählt zu den ältesten Hüttenwerken der Region. Sie nutzte ursprünglich die Wasserkraft der Prims und Holzkohle aus den umliegenden Wäldern. Heute ist das Werk Teil der Diehl Defence und produziert Hightech-Komponenten.",
                        fr:"Située dans le Hochwald (Nonnweiler-Otzenhausen). La Mariahütte compte parmi les plus anciennes usines sidérurgiques de la région. Elle utilisait à l'origine l'énergie hydraulique de la Prims et le charbon de bois des forêts environnantes. Aujourd'hui, l'usine fait partie de Diehl Defence et produit des composants de haute technologie.",
                        en:"Located in the Hochwald (Nonnweiler-Otzenhausen). The Mariahütte is one of the oldest ironworks in the region. It originally used the hydropower of the Prims river and charcoal from the surrounding forests. Today, the plant is part of Diehl Defence and produces high-tech components."
                    },
                    img:"img/mariahuette.jpg", copyright:"Foto: Leiflive"
                },
                {
                    id:"s9",name:"Hubertushütte",coords:[49.5800,6.9500],type:"Eisen",period:"1748-1868",
                    desc:{
                        de:"Ein historisches Eisenwerk bei Bierfeld (Nonnweiler). Wie viele Hütten im Hochwald basierte sie auf der Verhüttung lokaler Erze mit Holzkohle. Mit dem Aufkommen der Kokshochöfen an der Saar (die billiger produzierten) verlor sie an Bedeutung und musste schließen.",
                        fr:"Une usine de fer historique près de Bierfeld (Nonnweiler). Comme beaucoup d'usines du Hochwald, elle était basée sur la fusion de minerais locaux avec du charbon de bois. Avec l'avènement des hauts fourneaux au coke sur la Sarre (produisant moins cher), elle a perdu de son importance et a dû fermer.",
                        en:"A historic ironworks near Bierfeld (Nonnweiler). Like many works in the Hochwald, it was based on smelting local ores with charcoal. With the advent of coke blast furnaces on the Saar (which produced more cheaply), it lost importance and had to close."
                    },
                    img:"", copyright:""
                },
                {
                    id:"s10",name:"Geislauterner Eisenwerk",coords:[49.2350,6.8300],type:"Eisen",period:"1585-1875",
                    desc:{
                        de:"Geislautern gilt als eine der Wiegen der saarländischen Eisenindustrie. Bereits 1585 gegründet, war es ein technischer Vorreiter. Hier wurde sehr früh mit dem Einsatz von Dampfmaschinen experimentiert. Napoleon Bonaparte selbst soll Interesse an der strategisch wichtigen Produktion gezeigt haben.",
                        fr:"Geislautern est considéré comme l'un des berceaux de l'industrie du fer sarroise. Fondée dès 1585, c'était un pionnier technique. On y a expérimenté très tôt l'utilisation de machines à vapeur. Napoléon Bonaparte lui-même aurait montré de l'intérêt pour la production stratégiquement importante.",
                        en:"Geislautern is considered one of the cradles of the Saarland iron industry. Founded as early as 1585, it was a technical pioneer. Experiments with steam engines were conducted here very early on. Napoleon Bonaparte himself is said to have shown interest in the strategically important production."
                    },
                    img:"img/geislautern.jpg", copyright:"Foto: Zecke64"
                },
                {
                    id:"s11",name:"Eisenwerk Bettingen",coords:[49.4350,6.8600],type:"Eisen",period:"1686-1868",
                    desc:{
                        de:"Die 'Bettinger Schmelz' war so bedeutend, dass sie dem heutigen Ort 'Schmelz' ihren Namen gab. Sie verarbeitete Lebacher Eier (Eisenerzknollen) und nutzte die Wasserkraft der Prims. Ein schönes Beispiel dafür, wie Industrie Ortsnamen prägte.",
                        fr:"La 'Fonderie de Bettingen' était si importante qu'elle a donné son nom à la localité actuelle de 'Schmelz' (Fonderie). Elle traitait les 'œufs de Lebach' (nodules de minerai de fer) et utilisait l'énergie hydraulique de la Prims. Un bel exemple de la façon dont l'industrie a façonné les toponymes.",
                        en:"The 'Bettingen Smelter' was so significant that it gave the current town 'Schmelz' (Smelter) its name. It processed 'Lebach eggs' (iron ore nodules) and used the hydropower of the Prims river. A fine example of how industry shaped place names."
                    },
                    img:"", copyright:""
                },
                {
                    id:"s12",name:"Aschbacher Eisenwerk",coords:[49.2300,6.9100],type:"Eisen",period:"1724-1860",
                    desc:{
                        de:"Im heutigen Saarbrücker Stadtteil Gersweiler gelegen. Die Hütte ist ein typisches Beispiel für die Eisenindustrie der Barockzeit, gefördert durch die Grafen von Saarbrücken. Sie produzierte Töpfe, Öfen und Geländer.",
                        fr:"Située dans l'actuel quartier Gersweiler de Sarrebruck. L'usine est un exemple typique de l'industrie du fer de l'époque baroque, promue par les comtes de Sarrebruck. Elle produisait des pots, des poêles et des balustrades.",
                        en:"Located in the current Saarbrücken district of Gersweiler. The works are a typical example of the iron industry of the Baroque era, promoted by the Counts of Saarbrücken. It produced pots, stoves, and railings."
                    },
                    img:"", copyright:""
                },
                {
                    id:"s13",name:"Fischbacher Schmelze",coords:[49.3150,7.0400],type:"Eisen",period:"1728-1860",
                    desc:{
                        de:"Eine frühindustrielle Anlage im waldreichen Fischbachtal. Sie nutzte die Kohle der nahen Gruben (wie Camphausen), war aber technologisch bald den großen Werken am Fluss (Völklingen, Burbach) unterlegen, was zu ihrer Schließung führte.",
                        fr:"Une installation pré-industrielle dans la vallée boisée de Fischbach. Elle utilisait le charbon des mines proches (comme Camphausen), mais fut bientôt technologiquement inférieure aux grandes usines sur le fleuve (Völklingen, Burbach), ce qui conduisit à sa fermeture.",
                        en:"An early industrial facility in the wooded Fischbach Valley. It used coal from nearby mines (like Camphausen) but was soon technologically inferior to the large works on the river (Völklingen, Burbach), leading to its closure."
                    },
                    img:"", copyright:""
                },
                {
                    id:"s14",name:"Goffontaine",coords:[49.2250,7.0500],type:"Eisen",period:"18. Jh.",
                    desc:{
                        de:"In Schafbrücke gelegen. Bekannt für ihren Drahtzug und die Herstellung von Nägeln. Der Name geht auf den Gründer zurück. Ein Relikt aus der Zeit, als kleine Hämmer und Schmelzen entlang der Bäche im Saarbrücker Raum entstanden.",
                        fr:"Située à Schafbrücke. Connue pour sa tréfilerie et la fabrication de clous. Le nom remonte au fondateur. Un vestige de l'époque où de petits martinets et fonderies émergeaient le long des ruisseaux dans la région de Sarrebruck.",
                        en:"Located in Schafbrücke. Known for its wire drawing and nail manufacturing. The name goes back to the founder. A relic from the time when small hammers and smelters emerged along the streams in the Saarbrücken area."
                    },
                    img:"", copyright:""
                },
                {
                    id:"s15",name:"Wadgasser Hütte",coords:[49.2700,6.7900],type:"Eisen/Glas",period:"17.-19. Jh.",
                    desc:{
                        de:"Wadgassen hat eine doppelte Industriegeschichte. Ursprünglich gab es hier Eisenverarbeitung, die später von der berühmten Kristallglasfabrik (Villeroy & Boch) abgelöst wurde. Der Standort profitierte von der Nähe zur Saar für den Transport.",
                        fr:"Wadgassen a une double histoire industrielle. À l'origine, il y avait le traitement du fer, qui a été remplacé plus tard par la célèbre cristallerie (Villeroy & Boch). Le site a profité de la proximité de la Sarre pour le transport.",
                        en:"Wadgassen has a dual industrial history. Originally there was iron processing here, which was later replaced by the famous crystal glass factory (Villeroy & Boch). The location benefited from its proximity to the Saar river for transport."
                    },
                    img:"", copyright:""
                },
                {
                    id:"s16",name:"Karlsbrunner Hütte",coords:[49.1850,6.8300],type:"Eisen",period:"18. Jh.",
                    desc:{
                        de:"Tief im Warndt gelegen, war diese Hütte eng mit dem Jagdschloss Karlsbrunn verbunden. Sie nutzte die Ressourcen des Warndtwaldes. Heute erinnert vor allem der Ortsname und die Siedlungsstruktur an die industrielle Vergangenheit.",
                        fr:"Située au fond du Warndt, cette usine était étroitement liée au pavillon de chasse de Karlsbrunn. Elle utilisait les ressources de la forêt du Warndt. Aujourd'hui, c'est surtout le nom du lieu et la structure de l'habitat qui rappellent le passé industriel.",
                        en:"Located deep in the Warndt, this ironworks was closely linked to the Karlsbrunn hunting lodge. It utilized the resources of the Warndt forest. Today, mainly the place name and settlement structure remind of the industrial past."
                    },
                    img:"", copyright:""
                },
                {
                    id:"s18",name:"Hütte Wecklingen",coords:[49.2300,7.2500],type:"Eisen",period:"18. Jh.",
                    desc:{
                        de:"Eine kleinere historische Anlage im Bliestal bei Blieskastel. Sie zeigt, dass die Eisenverarbeitung im 18. Jahrhundert nicht nur auf das Kohlerevier beschränkt war, sondern auch in den ländlichen Randgebieten stattfand.",
                        fr:"Une petite installation historique dans la vallée de la Blies près de Blieskastel. Elle montre que le traitement du fer au 18ème siècle n'était pas limité au bassin houiller, mais avait aussi lieu dans les zones rurales périphériques.",
                        en:"A smaller historic facility in the Blies Valley near Blieskastel. It shows that iron processing in the 18th century was not limited to the coal district but also took place in rural peripheral areas."
                    },
                    img:"", copyright:""
                },
                {
                    id:"s19",name:"St. Ingberter Eisenwerk",coords:[49.2800,7.1200],type:"Eisen",period:"19. Jh.",
                    desc:{
                        de:"Neben der 'Alten Schmelz' gab es in St. Ingbert weitere bedeutende Eisenwerke, die sich auf die Draht- und Nagelproduktion spezialisierten. Die Stadt war lange Zeit das Zentrum der saarländischen Drahtindustrie.",
                        fr:"Outre la 'Alte Schmelz', il y avait à St. Ingbert d'autres usines de fer importantes spécialisées dans la production de fil et de clous. La ville a longtemps été le centre de l'industrie du fil sarroise.",
                        en:"Besides the 'Alte Schmelz', there were other significant ironworks in St. Ingbert specializing in wire and nail production. The city was the center of the Saarland wire industry for a long time."
                    },
                    img:"", copyright:""
                },
                {
                    id:"s20",name:"Röhrenwerke Bous",coords:[49.2750,6.8050],type:"Stahl",period:"Aktiv",
                    desc:{
                        de:"Die Mannesmann Röhrenwerke in Bous sind ein wichtiger Teil der modernen Stahlverarbeitung an der Saar. Hier werden nahtlose Stahlrohre hergestellt. Das Werk nutzt einen Elektrolichtbogenofen zum Schmelzen von Schrott – ein modernes Verfahren im Vergleich zu den alten Hochöfen.",
                        fr:"Les usines de tubes Mannesmann à Bous sont une partie importante de la transformation moderne de l'acier en Sarre. On y fabrique des tubes en acier sans soudure. L'usine utilise un four à arc électrique pour fondre la ferraille – un procédé moderne comparé aux anciens hauts fourneaux.",
                        en:"The Mannesmann pipe works in Bous are an important part of modern steel processing on the Saar. Seamless steel pipes are manufactured here. The plant uses an electric arc furnace to melt scrap – a modern process compared to the old blast furnaces."
                    },
                    img:"", copyright:""
                },
                {
                    id:"s21",name:"Hüttigweiler",coords:[49.3880,7.0800],type:"Eisen",period:"Mittelalter",
                    desc:{
                        de:"Der Name 'Hüttigweiler' (bei Illingen) deutet bereits auf die frühe Existenz von Hüttenwerken hin. Hier fand wohl schon sehr früh, möglicherweise im Mittelalter, eine erste Verarbeitung von oberflächennahen Erzen statt.",
                        fr:"Le nom 'Hüttigweiler' (près d'Illingen) indique déjà l'existence précoce d'usines sidérurgiques. Il y a probablement eu ici très tôt, peut-être au Moyen Âge, un premier traitement de minerais proches de la surface.",
                        en:"The name 'Hüttigweiler' (near Illingen) already points to the early existence of ironworks. Very early on, possibly in the Middle Ages, initial processing of near-surface ores likely took place here."
                    },
                    img:"", copyright:""
                }
            ]
        };

        const urbanDataRaw = [
            { name: "Saarbrücken", coords: [49.2333, 7.0000], desc: {de:"Landeshauptstadt", fr:"Capitale régionale", en:"State Capital"}, history: { 1926:95000, 1950:110000, 1970:125000, 1974:205000, 1990:191000, 2024:181900 }},
            { name: "Neunkirchen", coords: [49.3450, 7.1780], desc: {de:"Hüttenstadt", fr:"Ville de la sidérurgie", en:"Steel City"}, history: { 1926:38000, 1950:43000, 1965:48000, 1974:55000, 1990:51000, 2024:46900 }},
            { name: "Völklingen", coords: [49.2500, 6.8500], desc: {de:"Stahlstandort", fr:"Site sidérurgique", en:"Steel Site"}, history: { 1926:30000, 1950:39000, 1965:44000, 1974:48000, 1990:44000, 2024:40000 }},
            { name: "Sulzbach", coords: [49.3000, 7.0600], desc: {de:"Bergbauzentrum", fr:"Centre minier", en:"Mining Center"}, history: { 1926:20000, 1950:23000, 1960:25000, 1974:21000, 1990:19000, 2024:16000 }},
            { name: "Friedrichsthal", coords: [49.3250, 7.0950], desc: {de:"Bergbau", fr:"Mines", en:"Mining"}, history: { 1926:13000, 1950:15000, 1960:16000, 1974:14000, 1990:12000, 2024:10000 }},
            { name: "Saarlouis", coords: [49.3167, 6.7500], desc: {de:"Festungsstadt", fr:"Ville fortifiée", en:"Fortress City"}, history: { 1926:16000, 1950:30000, 1970:36000, 1974:40000, 1990:38000, 2024:34500 }},
            { name: "Homburg", coords: [49.3200, 7.3400], desc: {de:"Heute Uni & Industrie", fr:"Auj. Université & Industrie", en:"Today Uni & Industry"}, history: { 1926:12000, 1950:31000, 1970:35000, 1974:44000, 1990:45000, 2024:42000 }},
            { name: "St. Ingbert", coords: [49.2800, 7.1200], desc: {de:"Biosphäre", fr:"Biosphère", en:"Biosphere"}, history: { 1926:20000, 1950:27000, 1970:29000, 1974:40000, 1990:39000, 2024:35500 }},
            { name: "Merzig", coords: [49.4419, 6.6378], desc: {de:"Kreisstadt", fr:"Chef-lieu", en:"District Seat"}, history: { 1926:10000, 1950:14000, 1970:16000, 1974:28000, 1990:31000, 2024:30000 }},
            { name: "St. Wendel", coords: [49.4667, 7.1667], desc: {de:"Wirtschaftszentrum Nord", fr:"Centre éco. Nord", en:"Eco Center North"}, history: { 1926:8000, 1950:11000, 1970:12000, 1974:27000, 1990:27000, 2024:25500 }},
            { name: "Dillingen", coords: [49.3500, 6.7333], desc: {de:"Hüttenstadt", fr:"Ville sidérurgique", en:"Ironworks City"}, history: { 1926:9000, 1950:18000, 1965:21000, 1974:24000, 1990:22000, 2024:20000 }},
            { name: "Wadern", coords: [49.539, 6.893], desc: {de:"Mittelzentrum Hochwald", fr:"Centre Hochwald", en:"Hochwald Center"}, history: { 1926:12000, 1950:13500, 1974:15000, 1990:15800, 2024:15700 }},
            { name: "Losheim am See", coords: [49.510, 6.745], desc: {de:"Tourismus & Gewerbe", fr:"Tourisme & Commerce", en:"Tourism & Trade"}, history: { 1926:11000, 1950:13000, 1974:15000, 1990:16000, 2024:16000 }},
            { name: "Nonnweiler", coords: [49.606, 7.005], desc: {de:"Nationalpark-Gemeinde", fr:"Commune Parc National", en:"National Park Community"}, history: { 1926:7000, 1950:8000, 1974:9500, 1990:9200, 2024:8500 }},
            { name: "Lebach", coords: [49.412, 6.910], desc: {de:"Mittelpunkt des Saarlandes", fr:"Centre de la Sarre", en:"Center of Saarland"}, history: { 1926:6000, 1950:9000, 1974:21500, 1990:20000, 2024:18800 }},
            { name: "Schmelz", coords: [49.430, 6.850], desc: {de:"Heimat der Bettinger Schmelz", fr:"Foyer de la fonderie Bettingen", en:"Home of Bettingen Smelter"}, history: { 1926:8000, 1950:12000, 1974:17500, 1990:17500, 2024:16100 }}
        ];

        const transportData = [
            {name:"RE 1",desc:{de:"Trier - SB - Homburg", fr:"Trèves - SB - Homburg", en:"Trier - SB - Homburg"},color:"#db2777",path:[[49.600,6.550],[49.490,6.590],[49.441,6.637],[49.350,6.733],[49.316,6.750],[49.250,6.850],[49.233,7.000],[49.280,7.120],[49.320,7.340],[49.380,7.350]]},
            {name:"RE 3",desc:{de:"SB - NK - Mainz", fr:"SB - NK - Mayence", en:"SB - NK - Mainz"},color:"#0ea5e9",path:[[49.233,7.000],[49.300,7.060],[49.345,7.178],[49.405,7.165],[49.466,7.166],[49.580,7.150],[49.630,7.180]]},
            {name:"RB 68",desc:{de:"SB - St. Ingbert - Zweibrücken", fr:"SB - St. Ingbert - Deux-Ponts", en:"SB - St. Ingbert - Zweibrücken"},color:"#2563eb",path:[[49.233,7.000],[49.280,7.120],[49.250,7.250],[49.240,7.350]]},
            {name:"RB 72",desc:{de:"SB - Illingen - Lebach", fr:"SB - Illingen - Lebach", en:"SB - Illingen - Lebach"},color:"#8b5cf6",path:[[49.233,7.000],[49.325,7.050],[49.375,7.050],[49.410,6.910]]},
            {name:"RB 77",desc:{de:"Dillingen - Niedaltdorf", fr:"Dillingen - Niedaltdorf", en:"Dillingen - Niedaltdorf"},color:"#64748b",path:[[49.350,6.733],[49.350,6.600]]},
            {name:"Saarbahn",desc:{de:"Lebach - SB - Saargemünd", fr:"Lebach - SB - Sarreguemines", en:"Lebach - SB - Sarreguemines"},color:"#eab308",path:[[49.410,6.910],[49.340,6.930],[49.310,6.940],[49.233,7.000],[49.218,7.030],[49.155,7.035],[49.110,7.080]]}
        ];

        const map = L.map('map', { zoomControl: false }).setView([49.38, 6.95], 10);
        L.control.zoom({ position: 'bottomright' }).addTo(map);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {attribution: '&copy; CARTO', subdomains: 'abcd', maxZoom: 20}).addTo(map);
        let currentLayers = L.layerGroup().addTo(map);
        let borderLayer = L.layerGroup().addTo(map);

        // GEOJSON LOADER
        fetch('export.geojson')
            .then(r => r.json())
            .then(data => {
                const saarland = data.features.find(f => f.properties.name === 'Saarland');
                L.geoJSON(saarland || data, {
                    style: { color: '#64748b', weight: 2, fill: false, dashArray: '6, 6', opacity: 0.75 }
                }).addTo(borderLayer);
            })
            .catch(() => {
                L.polygon(fallbackBorder, {color: '#64748b', weight: 2, fill: false, dashArray: '6, 6', opacity: 0.75}).addTo(borderLayer);
            });

        function clearMap() { currentLayers.clearLayers(); document.getElementById('sidebar-content').innerHTML = ''; }

        function getPopForYear(history, year) {
            const years = Object.keys(history).map(Number).sort((a,b)=>a-b);
            if(year<=years[0]) return history[years[0]]; if(year>=years[years.length-1]) return history[years[years.length-1]];
            let prev=years[0], next=years[years.length-1];
            for(let y of years) { if(y<=year) prev=y; if(y>year) { next=y; break; } }
            const fraction = (year-prev)/(next-prev);
            return Math.round(history[prev] + fraction * (history[next]-history[prev]));
        }

        function updateUrbanMap(val) {
            currentYear = parseInt(val);
            document.getElementById('yearDisplay').innerText = currentYear;
            const totalPop = getPopForYear(saarlandPopData, currentYear);
            document.getElementById('total-pop-value').innerText = totalPop.toLocaleString();
            document.getElementById('total-pop-year').innerText = t('year_label') + ": " + currentYear;
            
            const badge = document.getElementById('reform-badge');
            if (currentYear >= 1973 && currentYear <= 1975) { badge.classList.remove('hidden'); } else { badge.classList.add('hidden'); }
            
            if (currentMode === 'urban') {
                 clearMap(); renderUrban(); 
            }
        }

        function expandSidebarItem(id) {
            const contentDiv = document.getElementById(`details-${id}`);
            if (contentDiv) {
                document.querySelectorAll('.details-content').forEach(el => { if(el.id !== `details-${id}`) el.classList.remove('open'); });
                contentDiv.classList.add('open');
                contentDiv.parentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function createExpandableListItem(item, iconClass, colorClass, onClickMarker) {
            const div = document.createElement('div');
            div.className = `group rounded-xl bg-white border border-slate-100 hover:border-slate-300 shadow-sm mb-2 overflow-hidden`;
            const dotColor = colorClass.replace('border-', 'bg-').replace('text-', 'bg-');
            
            let badgeText = item.type;
            if(item.type === "Kohle") badgeText = t('type_coal');
            else if(item.type === "Stahl") badgeText = t('type_steel');
            else if(item.type === "Eisen") badgeText = t('type_iron');
            
            let badgeHtml = '';
            if (item.type) {
                let badgeColor = "bg-slate-100 text-slate-600 border-slate-200";
                if (item.type === "Kohle") badgeColor = "bg-red-50 text-red-600 border-red-100";
                else if (item.type === "Eisen" || item.type === "Kupfer" || item.type === "Kalk") badgeColor = "bg-orange-50 text-orange-600 border-orange-100";
                else if (item.type === "Stahl") badgeColor = "bg-slate-50 text-slate-600 border-slate-200";
                badgeHtml = `<span class="${badgeColor} text-[10px] font-bold px-2 py-0.5 rounded border ml-2">${badgeText}</span>`;
            }

            let imgHtml = '';
            if(item.img && item.img !== "") {
                imgHtml = `<img src="${item.img}" alt="${item.name}" class="location-img rounded-lg mb-2 shadow-sm" onerror="this.style.display='none'">`;
                if(item.copyright) { imgHtml += `<div class="copyright-text">${item.copyright}</div>`; }
            }

            // Create content HTML
            const contentHtml = `
                <div class="header-part p-3.5 flex items-center gap-3.5 cursor-pointer">
                    <div class="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-xl text-slate-500"><i class="${iconClass}"></i></div>
                    <div class="flex-1"><div class="font-bold text-sm text-slate-800 flex items-center">${item.name} <span class="md:hidden">${badgeHtml}</span></div><div class="text-xs text-slate-500 font-medium">${item.period}</div></div><div class="w-2 h-2 rounded-full ${dotColor}"></div>
                </div>
                <div id="details-${item.id}" class="details-content bg-slate-50 text-xs text-slate-600 px-4">
                    <div class="py-3 border-t border-slate-200">
                        ${imgHtml}
                        <div class="mb-2 hidden md:block">${badgeHtml}</div>
                        <p class="leading-relaxed text-justify">${getLangText(item.desc)}</p>
                        <button class="show-map-btn mt-4 w-full py-2 bg-white border border-slate-200 rounded-lg text-blue-600 font-bold hover:bg-blue-50 transition-colors flex items-center justify-center gap-2">
                            <i class="ph-bold ph-map-pin"></i> ${t('show_on_map')}
                        </button>
                    </div>
                </div>`;
            
            div.innerHTML = contentHtml;

            // Attach event listeners properly (closure safe)
            const header = div.querySelector('.header-part');
            const details = div.querySelector(`#details-${item.id}`);
            const mapBtn = div.querySelector('.show-map-btn');

            header.onclick = () => {
                details.classList.toggle('open');
                // Optional: Auto-pan on expand if desired, uncomment next line
                // if(onClickMarker) onClickMarker(); 
            };

            if(onClickMarker) {
                mapBtn.onclick = onClickMarker;
            } else {
                mapBtn.style.display = 'none';
            }

            return div;
        }

        function createSimpleListItem(title, subtitle, color, onClick) {
            const div = document.createElement('div');
            div.className = "p-3 mb-2 bg-white rounded-lg border-l-4 shadow-sm text-sm cursor-pointer hover:bg-slate-50";
            div.style.borderLeftColor = color;
            div.innerHTML = `<b>${title}</b><br><span class="text-xs text-slate-500">${subtitle}</span>`;
            div.onclick = onClick;
            return div;
        }

        const getMineIcon = (c) => L.divIcon({className: 'custom-div-icon', html: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${c}" stroke="white" stroke-width="1.5" class="w-8 h-8 drop-shadow-lg"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><text x="12" y="15" text-anchor="middle" fill="white" stroke="none" font-size="10" font-weight="900" font-family="Inter">G</text></svg>`, iconSize: [32,32], iconAnchor: [16,32], popupAnchor: [0,-32]});
        const getOreIcon = (c) => L.divIcon({className: 'custom-div-icon', html: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${c}" stroke="white" stroke-width="1.5" class="w-8 h-8 drop-shadow-lg"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><text x="12" y="15" text-anchor="middle" fill="white" stroke="none" font-size="10" font-weight="900" font-family="Inter">E</text></svg>`, iconSize: [32,32], iconAnchor: [16,32], popupAnchor: [0,-32]});
        const getSteelIcon = (c) => L.divIcon({className: 'custom-div-icon', html: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${c}" stroke="white" stroke-width="1.5" class="w-8 h-8 drop-shadow-lg"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><text x="12" y="15" text-anchor="middle" fill="white" stroke="none" font-size="10" font-weight="900" font-family="Inter">H</text></svg>`, iconSize: [32,32], iconAnchor: [16,32], popupAnchor: [0,-32]});

        function addOverviewLines(containerList) {
            const miningLine = L.polyline(overviewLines.mining.path, { color: overviewLines.mining.color, weight: 20, opacity: 0.6, lineCap: 'round', lineJoin: 'round', interactive: false }).addTo(currentLayers);
            const steelLine = L.polyline(overviewLines.steel.path, { color: overviewLines.steel.color, weight: 20, opacity: 0.6, lineCap: 'round', lineJoin: 'round', interactive: false }).addTo(currentLayers);
            if (containerList) { 
                const overlayInfo = document.createElement('div'); 
                overlayInfo.className = "mt-4 p-2 border-t border-slate-200 text-[10px] text-slate-400 text-center uppercase tracking-wider"; 
                overlayInfo.innerHTML = t('axis_note'); 
                containerList.appendChild(overlayInfo); 
                containerList.appendChild(createSimpleListItem(t('coal_belt'), "Historische Hauptachse", "#ef4444", () => map.fitBounds(miningLine.getBounds())));
                containerList.appendChild(createSimpleListItem(t('steel_axis'), "Industrielle Tallagen", "#475569", () => map.fitBounds(steelLine.getBounds())));
            }
        }

        function renderLegend(mode) {
            const container = document.getElementById('legend-content');
            const panel = document.getElementById('legend-panel');
            let html = '';
            if (mode === 'transport') { panel.classList.add('hidden'); panel.classList.remove('md:block'); return; }
            panel.classList.remove('hidden'); panel.classList.add('md:block');
            const borderLegend = `<div class="flex items-center gap-2.5 mt-2 pt-2 border-t border-slate-100"><span class="w-6 h-0 border-t-2 border-dashed border-slate-400"></span><span class="text-slate-500">${t('border_label')}</span></div>`;

            if (mode === 'history') {
                html = `<div class="flex items-center gap-2.5"><span class="w-3 h-3 rounded-full bg-red-500 border border-white shadow-sm"></span><span>${t('mining_legend')}</span></div>
                        <div class="flex items-center gap-2.5"><span class="w-3 h-3 rounded-full bg-slate-600 border border-white shadow-sm"></span><span>${t('steel_legend')}</span></div>`;
                if (currentViewMode === 'overview') {
                     html += `<div class="mt-2 pt-2 border-t border-slate-100"><div class="flex items-center gap-2.5"><span class="w-4 h-1 bg-red-500 rounded-full opacity-50"></span><span class="text-[10px] text-slate-500">${t('coal_belt')}</span></div><div class="flex items-center gap-2.5"><span class="w-4 h-1 bg-slate-600 rounded-full opacity-50"></span><span class="text-[10px] text-slate-500">${t('steel_axis')}</span></div></div>`;
                }
            } else if (mode === 'urban') {
                html = `<div class="flex items-center gap-2.5"><span class="w-3 h-3 rounded-full bg-purple-700 opacity-60"></span><span>> 100k EW</span></div>
                        <div class="flex items-center gap-2.5"><span class="w-3 h-3 rounded-full bg-purple-500 opacity-60"></span><span>> 30k EW</span></div>
                        <div class="flex items-center gap-2.5"><span class="w-3 h-3 rounded-full bg-purple-300 opacity-60"></span><span>< 30k EW</span></div>`;
                if (currentViewMode === 'overview') {
                     html += `<div class="mt-2 pt-2 border-t border-slate-100"><div class="flex items-center gap-2.5"><span class="w-4 h-1 bg-red-500 rounded-full opacity-50"></span><span class="text-[10px] text-slate-500">${t('coal_belt')}</span></div><div class="flex items-center gap-2.5"><span class="w-4 h-1 bg-slate-600 rounded-full opacity-50"></span><span class="text-[10px] text-slate-500">${t('steel_axis')}</span></div></div>`;
                }
            }
            container.innerHTML = html + borderLegend;
        }

        function renderHistory() {
            document.getElementById('sidebar-title').innerText = t('sb_history_title');
            document.getElementById('sidebar-desc').innerText = t('sb_history_desc');
            const list = document.getElementById('sidebar-content');
            
            if(currentViewMode === 'overview') {
                L.polyline(overviewLines.mining.path, {color: "#ef4444", weight: 20, opacity: 0.6}).addTo(currentLayers).bindTooltip(t('coal_belt'), {sticky: true});
                L.polyline(overviewLines.steel.path, {color: "#475569", weight: 20, opacity: 0.6}).addTo(currentLayers).bindTooltip(t('steel_axis'), {sticky: true});
                list.innerHTML = `<div class="p-4 bg-slate-50 text-slate-800 text-xs rounded-xl border border-slate-200">${t('analysis_struct')}</div>`;
                addOverviewLines(list);
            } else {
                historyData.mines.forEach(m => {
                    let icon = m.type === "Kohle" ? getMineIcon('#ef4444') : getOreIcon('#f97316');
                    let color = m.type === "Kohle" ? "bg-red-500" : "bg-orange-500";
                    const marker = L.marker(m.coords, {icon: icon}).addTo(currentLayers);

                    let badgeColor = m.type === "Kohle" ? "bg-red-50 text-red-600 border-red-100" : "bg-orange-50 text-orange-600 border-orange-100";
                    let badgeText = m.type;
                    if(m.type === "Kohle") badgeText = t('type_coal');
                    
                    let imgHtml = '';
                    if(m.img && m.img !== "") {
                         imgHtml = `<div class="h-32 w-full overflow-hidden bg-gray-100 mb-2 relative"><img src="${m.img}" class="w-full h-full object-cover" onerror="this.style.display='none'"></div>`;
                         if(m.copyright) { imgHtml += `<div style="font-size:9px; color:#999; text-align:right; margin-top:-15px; margin-right:5px; position:relative; z-index:10; text-shadow:0 1px 2px white;">${m.copyright}</div>`; }
                    }

                    marker.bindPopup(`
                        <div class="w-full bg-white p-3">
                            ${imgHtml}
                            <div class="flex justify-between items-start">
                                <b class="${m.type==='Kohle'?'text-red-600':'text-orange-600'} block text-sm">${m.name}</b>
                                <span class="${badgeColor} text-[9px] font-bold px-1.5 py-0.5 rounded border">${badgeText}</span>
                            </div>
                            <div class="text-xs text-slate-500 mt-1 mb-3">${m.period}</div>
                            <button onclick="expandSidebarItem('${m.id}')" class="w-full text-center bg-slate-100 hover:bg-slate-200 text-slate-700 text-xs font-bold py-1.5 rounded transition-colors">${t('more_info')}</button>
                        </div>
                    `);
                    list.appendChild(createExpandableListItem(m, m.type === "Kohle" ? "ph-pick-axe" : "ph-mountains", color, () => { map.flyTo(m.coords, 13); marker.openPopup(); }));
                });
                historyData.steel.forEach(s => {
                    const marker = L.marker(s.coords, {icon: getSteelIcon('#475569')}).addTo(currentLayers);
                    
                    let badgeColor = "bg-slate-50 text-slate-600 border-slate-200";
                    let badgeText = t('type_steel');
                    if(s.type === "Eisen") badgeText = t('type_iron');

                    let imgHtml = '';
                    if(s.img && s.img !== "") {
                         imgHtml = `<div class="h-32 w-full overflow-hidden bg-gray-100 mb-2 relative"><img src="${s.img}" class="w-full h-full object-cover" onerror="this.style.display='none'"></div>`;
                         if(s.copyright) { imgHtml += `<div style="font-size:9px; color:#999; text-align:right; margin-top:-15px; margin-right:5px; position:relative; z-index:10; text-shadow:0 1px 2px white;">${s.copyright}</div>`; }
                    }

                    marker.bindPopup(`
                        <div class="w-full bg-white p-3">
                            ${imgHtml}
                            <div class="flex justify-between items-start">
                                <b class="text-slate-700 block text-sm">${s.name}</b>
                                <span class="${badgeColor} text-[9px] font-bold px-1.5 py-0.5 rounded border">${badgeText}</span>
                            </div>
                            <div class="text-xs text-slate-500 mt-1 mb-3">${s.period}</div>
                            <button onclick="expandSidebarItem('${s.id}')" class="w-full text-center bg-slate-100 hover:bg-slate-200 text-slate-700 text-xs font-bold py-1.5 rounded transition-colors">${t('more_info')}</button>
                        </div>
                    `);
                    list.appendChild(createExpandableListItem(s, "ph-factory", "bg-slate-600", () => { map.flyTo(s.coords, 13); marker.openPopup(); }));
                });
            }
        }

        function renderUrban() {
            document.getElementById('sidebar-title').innerText = t('sb_urban_title');
            document.getElementById('sidebar-desc').innerText = t('sb_urban_desc');
            const list = document.getElementById('sidebar-content');
            document.getElementById('total-pop-display').classList.remove('hidden');
            
            if(currentViewMode === 'overview') {
                L.polyline(overviewLines.mining.path, {color: "#ef4444", weight: 20, opacity: 0.6}).addTo(currentLayers);
                L.polyline(overviewLines.steel.path, {color: "#475569", weight: 20, opacity: 0.6}).addTo(currentLayers);
                list.innerHTML = `<div class="p-4 bg-blue-50 text-blue-900 text-xs rounded-xl border border-blue-100 mb-2">${t('analysis_corr')}</div>`;
                addOverviewLines(list);
            }

            urbanDataRaw.forEach(city => {
                const pop = getPopForYear(city.history, currentYear);
                const radius = Math.sqrt(pop) * 20; 
                const color = pop > 100000 ? '#7e22ce' : (pop > 30000 ? '#a855f7' : '#d8b4fe');
                const circle = L.circle(city.coords, {color, fillColor: color, fillOpacity: 0.5, radius, weight: 1}).addTo(currentLayers);
                circle.bindPopup(`<b>${city.name}</b><br>${pop.toLocaleString()} EW`);
                const item = document.createElement('div');
                item.className = "p-3 mb-2 bg-white rounded-lg border-l-4 border-purple-500 shadow-sm text-sm cursor-pointer flex justify-between";
                item.innerHTML = `<span><b>${city.name}</b></span><span>${pop.toLocaleString()}</span>`;
                item.onclick = () => { map.flyTo(city.coords, 13); circle.openPopup(); };
                list.appendChild(item);
            });
        }

        function renderTransport() {
            document.getElementById('sidebar-title').innerText = t('sb_trans_title');
            document.getElementById('sidebar-desc').innerText = t('sb_trans_desc');
            const list = document.getElementById('sidebar-content');
            if(currentViewMode === 'overview') {
                 L.polyline(overviewLines.mining.path, {color: "#ef4444", weight: 20, opacity: 0.6}).addTo(currentLayers);
                 L.polyline(overviewLines.steel.path, {color: "#475569", weight: 20, opacity: 0.6}).addTo(currentLayers);
                 list.innerHTML = `<div class="p-4 bg-blue-50 text-blue-900 text-xs rounded-xl border border-blue-100">${t('analysis_path')}</div>`;
            }
            transportData.forEach(r => {
                const poly = L.polyline(r.path, {color: r.color, weight: 4}).addTo(currentLayers);
                list.appendChild(createSimpleListItem(r.name, getLangText(r.desc), r.color, () => map.fitBounds(poly.getBounds())));
            });
        }

        function setViewMode(v) { 
            currentViewMode = v; 
            
            const detailsBtn = document.getElementById('view-details');
            const overviewBtn = document.getElementById('view-overview');
            
            // Re-select logic handled by class toggling inside render/switch usually, 
            // but here let's ensure visuals update:
            const activeClass = "px-3 py-1.5 rounded-md text-xs font-bold bg-slate-800 text-white shadow transition-all flex items-center gap-1";
            const inactiveClass = "px-3 py-1.5 rounded-md text-xs font-bold text-slate-600 hover:bg-slate-100 transition-all flex items-center gap-1";

            if (v === 'details') {
                detailsBtn.className = activeClass;
                overviewBtn.className = inactiveClass;
            } else {
                detailsBtn.className = inactiveClass;
                overviewBtn.className = activeClass;
            }

            if (currentMode === 'urban') {
                updateUrbanMap(document.getElementById('yearSlider').value);
            } else {
                clearMap();
                if (currentMode === 'history') renderHistory();
                if (currentMode === 'transport') renderTransport();
            }
            
            renderLegend(currentMode);
        }

        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab-btn').forEach(b => { b.classList.remove('active'); b.classList.add('text-slate-600', 'bg-transparent'); });
            document.getElementById(`btn-${mode}`).classList.add('active');
            document.getElementById(`btn-${mode}`).classList.remove('text-slate-600', 'bg-transparent');

            const viewCtrl = document.getElementById('view-controls');
            const timeSlider = document.getElementById('time-slider-container');
            const popDisplay = document.getElementById('total-pop-display');
            
            viewCtrl.classList.remove('hidden'); 
            timeSlider.classList.add('hidden');
            popDisplay.classList.add('hidden');

            if(mode === 'urban') { 
                viewCtrl.classList.remove('hidden'); 
                timeSlider.classList.remove('hidden'); 
                popDisplay.classList.remove('hidden');
                if(!currentViewMode) currentViewMode = 'details';
                setViewMode(currentViewMode); // This updates map content
            } else {
                renderLegend(mode);
                clearMap();
                if (mode === 'history') renderHistory();
                if (mode === 'transport') renderTransport();
            }
        }

        setTimeout(() => { switchMode('history'); }, 100);
    </script>
</body>
</html>
